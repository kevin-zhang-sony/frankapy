

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>frankapy.franka_arm &mdash; frankapy 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> frankapy
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network.html">Network Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../running.html">Running the Robot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../frankaarm.html">Frankapy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Support</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">frankapy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>frankapy.franka_arm</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for frankapy.franka_arm</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">franka_arm.py</span>
<span class="sd">====================================</span>
<span class="sd">The core module of frankapy</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">signal</span><span class="o">,</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="k">import</span> <span class="n">time</span><span class="p">,</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">autolab_core</span> <span class="k">import</span> <span class="n">RigidTransform</span>
<span class="kn">import</span> <span class="nn">quaternion</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">product</span>

<span class="kn">import</span> <span class="nn">roslib</span>
<span class="n">roslib</span><span class="o">.</span><span class="n">load_manifest</span><span class="p">(</span><span class="s1">&#39;franka_interface_msgs&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">from</span> <span class="nn">actionlib</span> <span class="k">import</span> <span class="n">SimpleActionClient</span>
<span class="kn">from</span> <span class="nn">sensor_msgs.msg</span> <span class="k">import</span> <span class="n">JointState</span>
<span class="kn">from</span> <span class="nn">franka_interface_msgs.msg</span> <span class="k">import</span> <span class="n">ExecuteSkillAction</span>
<span class="kn">from</span> <span class="nn">franka_interface_msgs.srv</span> <span class="k">import</span> <span class="n">GetCurrentFrankaInterfaceStatusCmd</span>
<span class="kn">from</span> <span class="nn">franka_gripper.msg</span> <span class="k">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">.skill_list</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.franka_arm_state_client</span> <span class="k">import</span> <span class="n">FrankaArmStateClient</span>
<span class="kn">from</span> <span class="nn">.franka_constants</span> <span class="k">import</span> <span class="n">FrankaConstants</span> <span class="k">as</span> <span class="n">FC</span>
<span class="kn">from</span> <span class="nn">.franka_interface_common_definitions</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.ros_utils</span> <span class="k">import</span> <span class="n">BoxesPublisher</span>


<div class="viewcode-block" id="FrankaArm"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm">[docs]</a><span class="k">class</span> <span class="nc">FrankaArm</span><span class="p">:</span>

<div class="viewcode-block" id="FrankaArm.__init__"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">rosnode_name</span><span class="o">=</span><span class="s1">&#39;franka_arm_client&#39;</span><span class="p">,</span> 
            <span class="n">ros_log_level</span><span class="o">=</span><span class="n">rospy</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
            <span class="n">robot_num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">with_gripper</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">old_gripper</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">offline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">init_node</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a FrankaArm.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rosnode_name : :obj:`str`</span>
<span class="sd">            A name for the FrankaArm ROS Node.</span>

<span class="sd">        ros_log_level : :obj:`rospy.log_level` of int</span>
<span class="sd">            Passed to rospy.init_node.</span>

<span class="sd">        robot_num : :obj:`int`</span>
<span class="sd">            Number assigned to the current robot.</span>

<span class="sd">        with_gripper : :obj:`bool`</span>
<span class="sd">            Flag for whether the Franka gripper is attached.</span>

<span class="sd">        old_gripper : :obj:`bool`</span>
<span class="sd">            Flag for whether to run the franka_ros gripper or the old_gripper </span>
<span class="sd">            implementation.</span>

<span class="sd">        offline : :obj:`bool`</span>
<span class="sd">            Flag for whether to run the robot in the real world.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_skill_action_server_name</span> <span class="o">=</span> \
                <span class="s1">&#39;/execute_skill_action_server_node_</span><span class="si">{}</span><span class="s1">/execute_skill&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">robot_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_robot_state_server_name</span> <span class="o">=</span> \
                <span class="s1">&#39;/get_current_robot_state_server_node_</span><span class="si">{}</span><span class="s1">/get_current_robot_state_server&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">robot_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_franka_interface_status_server_name</span> <span class="o">=</span> \
                <span class="s1">&#39;/get_current_franka_interface_status_server_node_</span><span class="si">{}</span><span class="s1">/get_current_franka_interface_status_server&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">robot_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_homing_action_server_name</span> <span class="o">=</span> \
                <span class="s1">&#39;/franka_gripper_</span><span class="si">{}</span><span class="s1">/homing&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">robot_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_move_action_server_name</span> <span class="o">=</span> \
                <span class="s1">&#39;/franka_gripper_</span><span class="si">{}</span><span class="s1">/move&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">robot_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_stop_action_server_name</span> <span class="o">=</span> \
                <span class="s1">&#39;/franka_gripper_</span><span class="si">{}</span><span class="s1">/stop&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">robot_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_grasp_action_server_name</span> <span class="o">=</span> \
                <span class="s1">&#39;/franka_gripper_</span><span class="si">{}</span><span class="s1">/grasp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">robot_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_joint_states_name</span> <span class="o">=</span> \
                <span class="s1">&#39;/franka_gripper_</span><span class="si">{}</span><span class="s1">/joint_states&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">robot_num</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_in_skill</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offline</span> <span class="o">=</span> <span class="n">offline</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_with_gripper</span> <span class="o">=</span> <span class="n">with_gripper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_old_gripper</span> <span class="o">=</span> <span class="n">old_gripper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_gripper_command</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># init ROS</span>
        <span class="k">if</span> <span class="n">init_node</span><span class="p">:</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="n">rosnode_name</span><span class="p">,</span>
                            <span class="n">disable_signals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">log_level</span><span class="o">=</span><span class="n">ros_log_level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collision_boxes_pub</span> <span class="o">=</span> <span class="n">BoxesPublisher</span><span class="p">(</span><span class="s1">&#39;franka_collision_boxes_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">robot_num</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_joint_state_pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s1">&#39;franka_virtual_joints_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">robot_num</span><span class="p">),</span> <span class="n">JointState</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_client</span> <span class="o">=</span> <span class="n">FrankaArmStateClient</span><span class="p">(</span>
                <span class="n">new_ros_node</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">robot_state_server_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_robot_state_server_name</span><span class="p">,</span>
                <span class="n">offline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_offline</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offline</span><span class="p">:</span>
            <span class="c1"># set signal handler to handle ctrl+c and kill sigs</span>
            <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sigint_handler_gen</span><span class="p">())</span>
            
            <span class="n">rospy</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_franka_interface_status_server_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_franka_interface_status</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ServiceProxy</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_franka_interface_status_server_name</span><span class="p">,</span> <span class="n">GetCurrentFrankaInterfaceStatusCmd</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">SimpleActionClient</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_execute_skill_action_server_name</span><span class="p">,</span> <span class="n">ExecuteSkillAction</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">wait_for_server</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_franka_interface</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_with_gripper</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_old_gripper</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_homing_client</span> <span class="o">=</span> <span class="n">SimpleActionClient</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_homing_action_server_name</span><span class="p">,</span> <span class="n">HomingAction</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_homing_client</span><span class="o">.</span><span class="n">wait_for_server</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_move_client</span> <span class="o">=</span> <span class="n">SimpleActionClient</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_move_action_server_name</span><span class="p">,</span> <span class="n">MoveAction</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_move_client</span><span class="o">.</span><span class="n">wait_for_server</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_grasp_client</span> <span class="o">=</span> <span class="n">SimpleActionClient</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_grasp_action_server_name</span><span class="p">,</span> <span class="n">GraspAction</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_grasp_client</span><span class="o">.</span><span class="n">wait_for_server</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_stop_client</span> <span class="o">=</span> <span class="n">SimpleActionClient</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_stop_action_server_name</span><span class="p">,</span> <span class="n">StopAction</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_stop_client</span><span class="o">.</span><span class="n">wait_for_server</span><span class="p">()</span>

            <span class="c1"># done init ROS</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># set default identity tool delta pose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tool_delta_pose</span> <span class="o">=</span> <span class="n">RigidTransform</span><span class="p">(</span><span class="n">from_frame</span><span class="o">=</span><span class="s1">&#39;franka_tool&#39;</span><span class="p">,</span> 
                                               <span class="n">to_frame</span><span class="o">=</span><span class="s1">&#39;franka_tool_base&#39;</span><span class="p">)</span>

        <span class="c1"># Precompute things and preallocate np memory for collision checking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collision_boxes_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">COLLISION_BOX_SHAPES</span><span class="p">),</span> <span class="mi">10</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collision_boxes_data</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">=</span> <span class="n">FC</span><span class="o">.</span><span class="n">COLLISION_BOX_SHAPES</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_collision_box_hdiags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collision_box_vertices_offset</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_offset_signs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
        <span class="k">for</span> <span class="n">sizes</span> <span class="ow">in</span> <span class="n">FC</span><span class="o">.</span><span class="n">COLLISION_BOX_SHAPES</span><span class="p">:</span>
            <span class="n">hsizes</span> <span class="o">=</span> <span class="n">sizes</span><span class="o">/</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collision_box_vertices_offset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vertex_offset_signs</span> <span class="o">*</span> <span class="n">hsizes</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collision_box_hdiags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sizes</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collision_box_vertices_offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collision_box_vertices_offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collision_box_hdiags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collision_box_hdiags</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_collision_proj_axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box_vertices_offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrankaArm.wait_for_franka_interface"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.wait_for_franka_interface">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_franka_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Blocks execution until franka-interface gives ready signal.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        timeout : :obj:`float`</span>
<span class="sd">            Timeout in seconds to wait for franka-interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_FRANKA_INTERFACE_TIMEOUT</span> <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">timeout</span>
        <span class="n">t_start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_start</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
            <span class="n">franka_interface_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_franka_interface_status</span><span class="p">()</span><span class="o">.</span><span class="n">franka_interface_status</span>
            <span class="k">if</span> <span class="n">franka_interface_status</span><span class="o">.</span><span class="n">is_ready</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">1e-2</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">FrankaArmCommException</span><span class="p">(</span><span class="s1">&#39;FrankaInterface status not ready for </span><span class="si">{}</span><span class="s1">s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_FRANKA_INTERFACE_TIMEOUT</span><span class="p">))</span></div>

<div class="viewcode-block" id="FrankaArm.wait_for_skill"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.wait_for_skill">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_skill</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Blocks execution until skill is done.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_skill_done</span><span class="p">():</span>
            <span class="k">continue</span></div>

<div class="viewcode-block" id="FrankaArm.wait_for_gripper"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.wait_for_gripper">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_gripper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Blocks execution until gripper is done.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_gripper_command</span> <span class="o">==</span> <span class="s2">&quot;Grasp&quot;</span><span class="p">:</span>
            <span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_grasp_client</span><span class="o">.</span><span class="n">wait_for_result</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_gripper_command</span> <span class="o">==</span> <span class="s2">&quot;Homing&quot;</span><span class="p">:</span>
            <span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_homing_client</span><span class="o">.</span><span class="n">wait_for_result</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_gripper_command</span> <span class="o">==</span> <span class="s2">&quot;Stop&quot;</span><span class="p">:</span>
            <span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_stop_client</span><span class="o">.</span><span class="n">wait_for_result</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_gripper_command</span> <span class="o">==</span> <span class="s2">&quot;Move&quot;</span><span class="p">:</span>
            <span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_move_client</span><span class="o">.</span><span class="n">wait_for_result</span><span class="p">()</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="FrankaArm.is_skill_done"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.is_skill_done">[docs]</a>    <span class="k">def</span> <span class="nf">is_skill_done</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether skill is done.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ignore_errors : :obj:`bool`</span>
<span class="sd">            Flag of whether to ignore errors.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :obj:`bool`</span>
<span class="sd">            Flag of whether the skill is done.</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_skill</span><span class="p">:</span>  
            <span class="k">return</span> <span class="kc">True</span> 

        <span class="n">franka_interface_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_current_franka_interface_status</span><span class="p">()</span><span class="o">.</span><span class="n">franka_interface_status</span>  

        <span class="n">e</span> <span class="o">=</span> <span class="kc">None</span>  
        <span class="k">if</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span> 
            <span class="n">e</span> <span class="o">=</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;rospy is down!&#39;</span><span class="p">)</span>  
        <span class="k">elif</span> <span class="n">franka_interface_status</span><span class="o">.</span><span class="n">error_description</span><span class="p">:</span>  
            <span class="n">e</span> <span class="o">=</span> <span class="n">FrankaArmException</span><span class="p">(</span><span class="n">franka_interface_status</span><span class="o">.</span><span class="n">error_description</span><span class="p">)</span>  
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">franka_interface_status</span><span class="o">.</span><span class="n">is_ready</span><span class="p">:</span> 
            <span class="n">e</span> <span class="o">=</span> <span class="n">FrankaArmFrankaInterfaceNotReadyException</span><span class="p">()</span> 

        <span class="k">if</span> <span class="n">e</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">ignore_errors</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_franka_interface</span><span class="p">()</span> 
            <span class="k">else</span><span class="p">:</span> 
                <span class="k">raise</span> <span class="n">e</span> 

        <span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">wait_for_result</span><span class="p">(</span><span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="o">.</span><span class="n">from_sec</span><span class="p">(</span>  
            <span class="n">FC</span><span class="o">.</span><span class="n">ACTION_WAIT_LOOP_TIME</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">done</span><span class="p">:</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">_in_skill</span> <span class="o">=</span> <span class="kc">False</span>  

        <span class="k">return</span> <span class="n">done</span></div>

<div class="viewcode-block" id="FrankaArm.stop_skill"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.stop_skill">[docs]</a>    <span class="k">def</span> <span class="nf">stop_skill</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stops the current skill.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_skill</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cancel_goal</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_skill</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_sigint_handler_gen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">sigint_handler</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_in_skill</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cancel_goal</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sigint_handler</span>

    <span class="k">def</span> <span class="nf">_send_goal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goal</span><span class="p">,</span> <span class="n">cb</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends the goal to the Franka Interface ROS Action Server</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        goal : :obj:`ExecuteSkillGoal`</span>
<span class="sd">            Skill with parameters that are sent to franka-interface.</span>

<span class="sd">        cb : :obj:`function`</span>
<span class="sd">            Function that takes in ExecuteSkillFeedback during skill execution.</span>

<span class="sd">        block : :obj:`bool`</span>
<span class="sd">            Flag that determines whether to block until skill is finished.</span>

<span class="sd">        ignore_errors : :obj:`bool`</span>
<span class="sd">            Flag of whether to ignore errors.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :obj:`ExecuteSkillResult`</span>
<span class="sd">            Skill Results that are sent from franka-interface.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">            FrankaArmCommException if a timeout is reached</span>
<span class="sd">            FrankaArmException if franka-interface gives an error</span>
<span class="sd">            FrankaArmFrankaInterfaceNotReadyException if franka-interface is not ready</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offline</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;In offline mode, FrankaArm will not execute real robot commands.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_skill_done</span><span class="p">():</span>  
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot send another command when the previous skill is active!&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_in_skill</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span> <span class="n">feedback_cb</span><span class="o">=</span><span class="n">cb</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">block</span><span class="p">:</span>  
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_skill</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Controls</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FrankaArm.goto_pose"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.goto_pose">[docs]</a>    <span class="k">def</span> <span class="nf">goto_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">tool_pose</span><span class="p">,</span>
                  <span class="n">duration</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                  <span class="n">use_impedance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">buffer_time</span><span class="o">=</span><span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_TERM_BUFFER_TIME</span><span class="p">,</span>
                  <span class="n">force_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">torque_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">cartesian_impedances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">joint_impedances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">ignore_virtual_walls</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;GoToPose&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Commands Arm to the given pose via min jerk interpolation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            tool_pose : :obj:`autolab_core.RigidTransform`</span>
<span class="sd">                End-effector pose in tool frame</span>
<span class="sd">            duration : :obj:`float`</span>
<span class="sd">                How much time this robot motion should take.</span>
<span class="sd">            use_impedance : :obj:`bool`</span>
<span class="sd">                Function uses our impedance controller by default. </span>
<span class="sd">                If False, uses the Franka cartesian controller.</span>
<span class="sd">            dynamic : :obj:`bool`</span>
<span class="sd">                Flag that states whether the skill is dynamic.  </span>
<span class="sd">                If True, it will use our joint impedance controller </span>
<span class="sd">                and sensor values.</span>
<span class="sd">            buffer_time : :obj:`float`</span>
<span class="sd">                How much extra time the termination handler will wait</span>
<span class="sd">                before stopping the skill after duration has passed.</span>
<span class="sd">            force_thresholds : :obj:`list`</span>
<span class="sd">                List of 6 floats corresponding to force limits on </span>
<span class="sd">                translation (xyz) and rotation about (xyz) axes.</span>
<span class="sd">                Default is None. If None then will not stop on contact.</span>
<span class="sd">            torque_thresholds : :obj:`list`</span>
<span class="sd">                List of 7 floats corresponding to torque limits on each joint. </span>
<span class="sd">                Default is None. If None then will not stop on contact.</span>
<span class="sd">            cartesian_impedances : :obj:`list`</span>
<span class="sd">                List of 6 floats corresponding to impedances on translation </span>
<span class="sd">                (xyz) and rotation about (xyz) axes. Default is None. </span>
<span class="sd">                If None then will use default impedances.</span>
<span class="sd">            joint_impedances : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to impedances on each joint. </span>
<span class="sd">                This is used when use_impedance is False. Default is None. </span>
<span class="sd">                If None then will use default impedances.</span>
<span class="sd">            block : :obj:`bool` </span>
<span class="sd">                Function blocks by default. If False, the function becomes</span>
<span class="sd">                asynchronous and can be preempted.</span>
<span class="sd">            ignore_errors : :obj:`bool` </span>
<span class="sd">                Function ignores errors by default. If False, errors and </span>
<span class="sd">                some exceptions can be thrown.</span>
<span class="sd">            ignore_virtual_walls : :obj:`bool` </span>
<span class="sd">                Function checks for collisions with virtual walls by default. </span>
<span class="sd">                If False, the robot no longer checks, which may be dangerous.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on the Control PC.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">            ValueError: If tool_pose does not have from_frame=franka_tool and </span>
<span class="sd">                        to_frame=world or tool_pose is outside the virtual walls.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dynamic</span><span class="p">:</span>
            <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">ImpedanceControlSkill</span><span class="p">,</span> 
                          <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">PassThroughPoseTrajectoryGenerator</span><span class="p">,</span>
                          <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">CartesianImpedanceFeedbackController</span><span class="p">,</span>
                          <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">TimeTerminationHandler</span><span class="p">,</span> 
                          <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>
            <span class="n">use_impedance</span><span class="o">=</span><span class="kc">True</span>
            <span class="n">block</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_impedance</span><span class="p">:</span>
                <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">ImpedanceControlSkill</span><span class="p">,</span> 
                              <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">MinJerkPoseTrajectoryGenerator</span><span class="p">,</span>
                              <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">CartesianImpedanceFeedbackController</span><span class="p">,</span>
                              <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">FinalPoseTerminationHandler</span><span class="p">,</span> 
                              <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">CartesianPoseSkill</span><span class="p">,</span> 
                              <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">MinJerkPoseTrajectoryGenerator</span><span class="p">,</span>
                              <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">SetInternalImpedanceFeedbackController</span><span class="p">,</span>
                              <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">FinalPoseTerminationHandler</span><span class="p">,</span> 
                              <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">tool_pose</span><span class="o">.</span><span class="n">from_frame</span> <span class="o">!=</span> <span class="s1">&#39;franka_tool&#39;</span> <span class="ow">or</span> <span class="n">tool_pose</span><span class="o">.</span><span class="n">to_frame</span> <span class="o">!=</span> <span class="s1">&#39;world&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;pose has invalid frame names! Make sure pose has </span><span class="se">\</span>
<span class="s1">                              from_frame=franka_tool and to_frame=world&#39;</span><span class="p">)</span>

        <span class="n">tool_base_pose</span> <span class="o">=</span> <span class="n">tool_pose</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tool_delta_pose</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_virtual_walls</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span>
            <span class="n">tool_base_pose</span><span class="o">.</span><span class="n">translation</span> <span class="o">&lt;=</span> <span class="n">FC</span><span class="o">.</span><span class="n">WORKSPACE_WALLS</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">tool_base_pose</span><span class="o">.</span><span class="n">translation</span> <span class="o">&gt;=</span> <span class="n">FC</span><span class="o">.</span><span class="n">WORKSPACE_WALLS</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Target pose is outside of workspace virtual walls!&#39;</span><span class="p">)</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">add_initial_sensor_values</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">EMPTY_SENSOR_VALUES</span><span class="p">)</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">set_cartesian_impedances</span><span class="p">(</span><span class="n">use_impedance</span><span class="p">,</span> <span class="n">cartesian_impedances</span><span class="p">,</span> <span class="n">joint_impedances</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">skill</span><span class="o">.</span><span class="n">check_for_contact_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">,</span> <span class="n">force_thresholds</span><span class="p">,</span> <span class="n">torque_thresholds</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dynamic</span><span class="p">:</span>
                <span class="n">skill</span><span class="o">.</span><span class="n">add_time_termination_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">skill</span><span class="o">.</span><span class="n">add_pose_threshold_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">,</span> <span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_POSE_THRESHOLDS</span><span class="p">)</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">add_goal_pose</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">tool_base_pose</span><span class="p">)</span>
        <span class="n">goal</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">create_goal</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span>
                        <span class="n">cb</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">skill</span><span class="o">.</span><span class="n">feedback_callback</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                        <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
                        <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dynamic</span><span class="p">:</span>
            <span class="n">sleep</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">DYNAMIC_SKILL_WAIT_TIME</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrankaArm.goto_pose_delta"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.goto_pose_delta">[docs]</a>    <span class="k">def</span> <span class="nf">goto_pose_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">delta_tool_pose</span><span class="p">,</span>
                        <span class="n">duration</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">use_impedance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">buffer_time</span><span class="o">=</span><span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_TERM_BUFFER_TIME</span><span class="p">,</span>
                        <span class="n">force_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">torque_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">cartesian_impedances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">joint_impedances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">ignore_virtual_walls</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;GoToPoseDelta&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Commands Arm to the given delta pose via min jerk interpolation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            delta_tool_pose : :obj:`autolab_core.RigidTransform` </span>
<span class="sd">                Delta pose in tool frame</span>
<span class="sd">            duration : :obj:`float` </span>
<span class="sd">                How much time this robot motion should take.</span>
<span class="sd">            use_impedance : :obj:`bool` </span>
<span class="sd">                Function uses our impedance controller by default. </span>
<span class="sd">                If False, uses the Franka cartesian controller.</span>
<span class="sd">            buffer_time : :obj:`float` </span>
<span class="sd">                How much extra time the termination handler will wait</span>
<span class="sd">                before stopping the skill after duration has passed.</span>
<span class="sd">            force_thresholds : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to force limits on translation </span>
<span class="sd">                (xyz) and rotation about (xyz) axes.</span>
<span class="sd">                Default is None. If None then will not stop on contact.</span>
<span class="sd">            torque_thresholds : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to torque limits on each joint. </span>
<span class="sd">                Default is None. If None then will not stop on contact.</span>
<span class="sd">            cartesian_impedances : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to impedances on translation </span>
<span class="sd">                (xyz) and rotation about (xyz) axes. Default is None. </span>
<span class="sd">                If None then will use default impedances.</span>
<span class="sd">            joint_impedances : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to impedances on each joint. </span>
<span class="sd">                This is used when use_impedance is False. Default is None. </span>
<span class="sd">                If None then will use default impedances.</span>
<span class="sd">            block : :obj:`bool` </span>
<span class="sd">                Function blocks by default. If False, the function becomes</span>
<span class="sd">                asynchronous and can be preempted.</span>
<span class="sd">            ignore_errors : :obj:`bool` </span>
<span class="sd">                Function ignores errors by default. If False, errors and </span>
<span class="sd">                some exceptions can be thrown.</span>
<span class="sd">            ignore_virtual_walls : :obj:`bool` </span>
<span class="sd">                Function checks for collisions with virtual walls by default. </span>
<span class="sd">                If False, the robot no longer checks, which may be dangerous.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on the Control PC.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If delta_pose does not have from_frame=franka_tool and </span>
<span class="sd">                        to_frame=franka_tool or from_frame=world and to_frame=world.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">use_impedance</span><span class="p">:</span>
            <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">ImpedanceControlSkill</span><span class="p">,</span> 
                          <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">RelativeMinJerkPoseTrajectoryGenerator</span><span class="p">,</span>
                          <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">CartesianImpedanceFeedbackController</span><span class="p">,</span>
                          <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">FinalPoseTerminationHandler</span><span class="p">,</span> 
                          <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">CartesianPoseSkill</span><span class="p">,</span> 
                          <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">RelativeMinJerkPoseTrajectoryGenerator</span><span class="p">,</span>
                          <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">SetInternalImpedanceFeedbackController</span><span class="p">,</span>
                          <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">FinalPoseTerminationHandler</span><span class="p">,</span> 
                          <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">add_initial_sensor_values</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">EMPTY_SENSOR_VALUES</span><span class="p">)</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">set_cartesian_impedances</span><span class="p">(</span><span class="n">use_impedance</span><span class="p">,</span> <span class="n">cartesian_impedances</span><span class="p">,</span> <span class="n">joint_impedances</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">skill</span><span class="o">.</span><span class="n">check_for_contact_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">,</span> <span class="n">force_thresholds</span><span class="p">,</span> <span class="n">torque_thresholds</span><span class="p">):</span>
            <span class="n">skill</span><span class="o">.</span><span class="n">add_pose_threshold_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">,</span> <span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_POSE_THRESHOLDS</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">delta_tool_pose</span><span class="o">.</span><span class="n">from_frame</span> <span class="o">==</span> <span class="s1">&#39;world&#39;</span> \
                <span class="ow">and</span> <span class="n">delta_tool_pose</span><span class="o">.</span><span class="n">to_frame</span> <span class="o">==</span> <span class="s1">&#39;world&#39;</span><span class="p">:</span>

            <span class="n">skill</span><span class="o">.</span><span class="n">add_goal_pose</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">delta_tool_pose</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">delta_tool_pose</span><span class="o">.</span><span class="n">from_frame</span> <span class="o">==</span> <span class="s1">&#39;franka_tool&#39;</span> \
                <span class="ow">and</span> <span class="n">delta_tool_pose</span><span class="o">.</span><span class="n">to_frame</span> <span class="o">==</span> <span class="s1">&#39;franka_tool&#39;</span><span class="p">:</span>
            <span class="n">starting_pose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pose</span><span class="p">()</span>

            <span class="n">starting_tool_base_pose</span> <span class="o">=</span> <span class="n">starting_pose</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tool_delta_pose</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span>

            <span class="n">final_goal_pose</span> <span class="o">=</span> <span class="n">starting_pose</span> <span class="o">*</span> <span class="n">delta_tool_pose</span>

            <span class="n">final_tool_base_pose</span> <span class="o">=</span> <span class="n">final_goal_pose</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tool_delta_pose</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span>

            <span class="n">delta_tool_base_pose</span> <span class="o">=</span> <span class="n">starting_tool_base_pose</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span> <span class="o">*</span> <span class="n">final_tool_base_pose</span>

            <span class="n">starting_rotation</span> <span class="o">=</span> <span class="n">RigidTransform</span><span class="p">(</span>
                <span class="n">rotation</span><span class="o">=</span><span class="n">starting_pose</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span>
                <span class="n">from_frame</span><span class="o">=</span><span class="s1">&#39;franka_tool&#39;</span><span class="p">,</span> <span class="n">to_frame</span><span class="o">=</span><span class="s1">&#39;franka_tool&#39;</span>
            <span class="p">)</span>
            <span class="n">predicted_translation</span> <span class="o">=</span> <span class="n">RigidTransform</span><span class="p">(</span>
                <span class="n">translation</span><span class="o">=</span><span class="n">delta_tool_base_pose</span><span class="o">.</span><span class="n">translation</span><span class="p">,</span>
                <span class="n">from_frame</span><span class="o">=</span><span class="s1">&#39;franka_tool&#39;</span><span class="p">,</span> <span class="n">to_frame</span><span class="o">=</span><span class="s1">&#39;franka_tool&#39;</span>
            <span class="p">)</span>
            <span class="n">actual_translation</span> <span class="o">=</span> <span class="n">starting_rotation</span> <span class="o">*</span> <span class="n">predicted_translation</span>
            <span class="n">delta_tool_base_pose</span><span class="o">.</span><span class="n">translation</span> <span class="o">=</span> <span class="n">actual_translation</span><span class="o">.</span><span class="n">translation</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_virtual_walls</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offline</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span>
                    <span class="n">final_tool_base_pose</span><span class="o">.</span><span class="n">translation</span> <span class="o">&lt;=</span> <span class="n">FC</span><span class="o">.</span><span class="n">WORKSPACE_WALLS</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                    <span class="n">final_tool_base_pose</span><span class="o">.</span><span class="n">translation</span> <span class="o">&gt;=</span> <span class="n">FC</span><span class="o">.</span><span class="n">WORKSPACE_WALLS</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Target pose is outside of workspace virtual walls!&#39;</span><span class="p">)</span>

            <span class="n">skill</span><span class="o">.</span><span class="n">add_goal_pose</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">delta_tool_base_pose</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;delta_pose has invalid frame names! &#39;</span> \
                             <span class="s1">&#39;Make sure delta_pose has from_frame=franka_tool &#39;</span> \
                             <span class="s1">&#39;and to_frame=franka_tool or from_frame=world and </span><span class="se">\</span>
<span class="s1">                             to_frame=world&#39;</span><span class="p">)</span>

        <span class="n">goal</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">create_goal</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span>
                        <span class="n">cb</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">skill</span><span class="o">.</span><span class="n">feedback_callback</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                        <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
                        <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span></div>
            

<div class="viewcode-block" id="FrankaArm.goto_joints"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.goto_joints">[docs]</a>    <span class="k">def</span> <span class="nf">goto_joints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">joints</span><span class="p">,</span>
                    <span class="n">duration</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                    <span class="n">use_impedance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">buffer_time</span><span class="o">=</span><span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_TERM_BUFFER_TIME</span><span class="p">,</span>
                    <span class="n">force_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">torque_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">cartesian_impedances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">joint_impedances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">k_gains</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">d_gains</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">ignore_virtual_walls</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;GoToJoints&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Commands Arm to the given joint configuration</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            joints : :obj:`list` </span>
<span class="sd">                A list of 7 numbers that correspond to joint angles in radians.</span>
<span class="sd">            duration : :obj:`float` </span>
<span class="sd">                How much time this robot motion should take.</span>
<span class="sd">            use_impedance : :obj:`bool` </span>
<span class="sd">                Function uses the Franka joint impedance controller by default. </span>
<span class="sd">                If True, uses our joint impedance controller.</span>
<span class="sd">            dynamic : :obj:`bool` </span>
<span class="sd">                Flag that states whether the skill is dynamic. If True, it </span>
<span class="sd">                will use our joint impedance controller and sensor values.</span>
<span class="sd">            buffer_time : :obj:`float` </span>
<span class="sd">                How much extra time the termination handler will wait</span>
<span class="sd">                before stopping the skill after duration has passed.</span>
<span class="sd">            force_thresholds : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to force limits on translation </span>
<span class="sd">                (xyz) and rotation about (xyz) axes. Default is None. </span>
<span class="sd">                If None then will not stop on contact.</span>
<span class="sd">            torque_thresholds : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to torque limits on each joint. </span>
<span class="sd">                Default is None. If None then will not stop on contact.</span>
<span class="sd">            cartesian_impedances : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to impedances on translation </span>
<span class="sd">                (xyz) and rotation about (xyz) axes. Default is None. If None </span>
<span class="sd">                then will use default impedances.</span>
<span class="sd">            joint_impedances : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to impedances on each joint. </span>
<span class="sd">                This is used when use_impedance is False. Default is None. </span>
<span class="sd">                If None then will use default impedances.</span>
<span class="sd">            k_gains : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to the k_gains on each joint for </span>
<span class="sd">                our impedance controller. This is used when use_impedance is </span>
<span class="sd">                True. Default is None. If None then will use default k_gains.</span>
<span class="sd">            d_gains : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to the d_gains on each joint for </span>
<span class="sd">                our impedance controller. This is used when use_impedance is </span>
<span class="sd">                True. Default is None. If None then will use default d_gains.</span>
<span class="sd">            block : :obj:`bool` </span>
<span class="sd">                Function blocks by default. If False, the function becomes</span>
<span class="sd">                asynchronous and can be preempted.</span>
<span class="sd">            ignore_errors : :obj:`bool` </span>
<span class="sd">                Function ignores errors by default. If False, errors and some </span>
<span class="sd">                exceptions can be thrown.</span>
<span class="sd">            ignore_virtual_walls : :obj:`bool` </span>
<span class="sd">                Function checks for collisions with virtual walls by default. </span>
<span class="sd">                If False, the robot no longer checks, which may be dangerous.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on the Control PC.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If is_joints_reachable(joints) returns False</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">joints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">joints</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> 

        <span class="k">if</span> <span class="n">dynamic</span><span class="p">:</span>
            <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">ImpedanceControlSkill</span><span class="p">,</span> 
                          <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">PassThroughJointTrajectoryGenerator</span><span class="p">,</span>
                          <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">JointImpedanceFeedbackController</span><span class="p">,</span>
                          <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">TimeTerminationHandler</span><span class="p">,</span> 
                          <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>
            <span class="n">use_impedance</span><span class="o">=</span><span class="kc">True</span>
            <span class="n">block</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_impedance</span><span class="p">:</span>
                <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">ImpedanceControlSkill</span><span class="p">,</span> 
                              <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">MinJerkJointTrajectoryGenerator</span><span class="p">,</span>
                              <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">JointImpedanceFeedbackController</span><span class="p">,</span>
                              <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">FinalJointTerminationHandler</span><span class="p">,</span> 
                              <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">JointPositionSkill</span><span class="p">,</span> 
                              <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">MinJerkJointTrajectoryGenerator</span><span class="p">,</span>
                              <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">SetInternalImpedanceFeedbackController</span><span class="p">,</span>
                              <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">FinalJointTerminationHandler</span><span class="p">,</span> 
                              <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_joints_reachable</span><span class="p">(</span><span class="n">joints</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Joints not reachable!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_virtual_walls</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_joints_in_collision_with_boxes</span><span class="p">(</span><span class="n">joints</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Target joints in collision with virtual walls!&#39;</span><span class="p">)</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">add_initial_sensor_values</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">EMPTY_SENSOR_VALUES</span><span class="p">)</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">set_joint_impedances</span><span class="p">(</span><span class="n">use_impedance</span><span class="p">,</span> <span class="n">cartesian_impedances</span><span class="p">,</span> <span class="n">joint_impedances</span><span class="p">,</span> <span class="n">k_gains</span><span class="p">,</span> <span class="n">d_gains</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">skill</span><span class="o">.</span><span class="n">check_for_contact_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">,</span> <span class="n">force_thresholds</span><span class="p">,</span> <span class="n">torque_thresholds</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dynamic</span><span class="p">:</span>
                <span class="n">skill</span><span class="o">.</span><span class="n">add_time_termination_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">skill</span><span class="o">.</span><span class="n">add_joint_threshold_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">,</span> <span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_JOINT_THRESHOLDS</span><span class="p">)</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">add_goal_joints</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">joints</span><span class="p">)</span>
        <span class="n">goal</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">create_goal</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span>
                        <span class="n">cb</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">skill</span><span class="o">.</span><span class="n">feedback_callback</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                        <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
                        <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dynamic</span><span class="p">:</span>
            <span class="n">sleep</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">DYNAMIC_SKILL_WAIT_TIME</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrankaArm.execute_joint_dmp"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.execute_joint_dmp">[docs]</a>    <span class="k">def</span> <span class="nf">execute_joint_dmp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                          <span class="n">joint_dmp_info</span><span class="p">,</span> 
                          <span class="n">duration</span><span class="p">,</span> 
                          <span class="n">initial_sensor_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">use_impedance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                          <span class="n">buffer_time</span><span class="o">=</span><span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_TERM_BUFFER_TIME</span><span class="p">,</span>
                          <span class="n">force_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">torque_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">cartesian_impedances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">joint_impedances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                          <span class="n">k_gains</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                          <span class="n">d_gains</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                          <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                          <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;JointDmp&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Commands Arm to execute a given joint dmp</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            joint_dmp_info : :obj:`dict` </span>
<span class="sd">                Contains all the parameters of a joint DMP</span>
<span class="sd">                (tau, alpha, beta, num_basis, num_sensors, mu, h, and weights)</span>
<span class="sd">            duration : :obj:`float` </span>
<span class="sd">                How much time this robot motion should take.</span>
<span class="sd">            initial_sensor_values : :obj:`list` </span>
<span class="sd">                List of initial sensor values. If None it will default to ones.</span>
<span class="sd">            use_impedance : :obj:`bool` </span>
<span class="sd">                Function uses the Franka joint impedance controller by default. </span>
<span class="sd">                If True, uses our joint impedance controller.</span>
<span class="sd">            buffer_time : :obj:`float` </span>
<span class="sd">                How much extra time the termination handler will wait</span>
<span class="sd">                before stopping the skill after duration has passed.</span>
<span class="sd">            force_thresholds : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to force limits on translation </span>
<span class="sd">                (xyz) and rotation about (xyz) axes. Default is None. </span>
<span class="sd">                If None then will not stop on contact.</span>
<span class="sd">            torque_thresholds : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to torque limits on each joint. </span>
<span class="sd">                Default is None. If None then will not stop on contact.</span>
<span class="sd">            cartesian_impedances : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to impedances on translation </span>
<span class="sd">                (xyz) and rotation about (xyz) axes. Default is None. </span>
<span class="sd">                If None then will use default impedances.</span>
<span class="sd">            joint_impedances : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to impedances on each joint. </span>
<span class="sd">                This is used when use_impedance is False. Default is None. </span>
<span class="sd">                If None then will use default impedances.</span>
<span class="sd">            k_gains : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to the k_gains on each joint</span>
<span class="sd">                for our impedance controller. This is used when use_impedance is </span>
<span class="sd">                True. Default is None. If None then will use default k_gains.</span>
<span class="sd">            d_gains : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to the d_gains on each joint</span>
<span class="sd">                for our impedance controller. This is used when use_impedance is </span>
<span class="sd">                True. Default is None. If None then will use default d_gains.</span>
<span class="sd">            block : :obj:`bool`</span>
<span class="sd">                Function blocks by default. If False, the function </span>
<span class="sd">                becomes asynchronous and can be preempted.</span>
<span class="sd">            ignore_errors : :obj:`bool`</span>
<span class="sd">                Function ignores errors by default. </span>
<span class="sd">                If False, errors and some exceptions can be thrown.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on control-pc.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">use_impedance</span><span class="p">:</span>
            <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">ImpedanceControlSkill</span><span class="p">,</span> 
                          <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">JointDmpTrajectoryGenerator</span><span class="p">,</span>
                          <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">JointImpedanceFeedbackController</span><span class="p">,</span>
                          <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">FinalJointTerminationHandler</span><span class="p">,</span> 
                          <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">JointPositionSkill</span><span class="p">,</span> 
                          <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">JointDmpTrajectoryGenerator</span><span class="p">,</span>
                          <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">SetInternalImpedanceFeedbackController</span><span class="p">,</span>
                          <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">FinalJointTerminationHandler</span><span class="p">,</span> 
                          <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">initial_sensor_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">initial_sensor_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">joint_dmp_info</span><span class="p">[</span><span class="s1">&#39;num_sensors&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">add_initial_sensor_values</span><span class="p">(</span><span class="n">initial_sensor_values</span><span class="p">)</span>  <span class="c1"># sensor values</span>
        
        <span class="n">skill</span><span class="o">.</span><span class="n">add_joint_dmp_params</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">joint_dmp_info</span><span class="p">,</span> <span class="n">initial_sensor_values</span><span class="p">)</span>
        
        <span class="n">skill</span><span class="o">.</span><span class="n">set_joint_impedances</span><span class="p">(</span><span class="n">use_impedance</span><span class="p">,</span> <span class="n">cartesian_impedances</span><span class="p">,</span> <span class="n">joint_impedances</span><span class="p">,</span> <span class="n">k_gains</span><span class="p">,</span> <span class="n">d_gains</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">skill</span><span class="o">.</span><span class="n">check_for_contact_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">,</span> <span class="n">force_thresholds</span><span class="p">,</span> <span class="n">torque_thresholds</span><span class="p">):</span>
            <span class="n">skill</span><span class="o">.</span><span class="n">add_time_termination_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">)</span>

        <span class="n">goal</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">create_goal</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span>
                        <span class="n">cb</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">skill</span><span class="o">.</span><span class="n">feedback_callback</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                        <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
                        <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrankaArm.execute_pose_dmp"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.execute_pose_dmp">[docs]</a>    <span class="k">def</span> <span class="nf">execute_pose_dmp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                         <span class="n">pose_dmp_info</span><span class="p">,</span> 
                         <span class="n">duration</span><span class="p">,</span> 
                         <span class="n">use_goal_formulation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">initial_sensor_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">orientation_only</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">position_only</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">ee_frame</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">use_impedance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                         <span class="n">buffer_time</span><span class="o">=</span><span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_TERM_BUFFER_TIME</span><span class="p">,</span>
                         <span class="n">force_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">torque_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">cartesian_impedances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">joint_impedances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                         <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                         <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;PoseDmp&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Commands Arm to execute a given pose dmp</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            pose_dmp_info : :obj:`dict`</span>
<span class="sd">                Contains all the parameters of a pose DMP</span>
<span class="sd">                (tau, alpha, beta, num_basis, num_sensors, mu, h, and weights)</span>
<span class="sd">            duration : :obj:`float`</span>
<span class="sd">                How much time this robot motion should take.</span>
<span class="sd">            use_goal_formulation : :obj:`bool`</span>
<span class="sd">                Flag that represents whether to use the explicit goal pose </span>
<span class="sd">                dmp formulation.</span>
<span class="sd">            initial_sensor_values : :obj:`list` </span>
<span class="sd">                List of initial sensor values. If None it will default to ones.</span>
<span class="sd">            orientation_only : :obj:`bool`</span>
<span class="sd">                Flag that represents if the dmp weights are to generate a dmp </span>
<span class="sd">                only for orientation.</span>
<span class="sd">            position_only : :obj:`bool`</span>
<span class="sd">                Flag that represents if the dmp weights are to generate a dmp </span>
<span class="sd">                only for position.</span>
<span class="sd">            ee_frame : :obj:`bool`</span>
<span class="sd">                Flag that indicates whether the dmp is in terms of the </span>
<span class="sd">                end-effector frame.</span>
<span class="sd">            use_impedance : :obj:`bool`</span>
<span class="sd">                Function uses our impedance controller by default. If False, </span>
<span class="sd">                uses the Franka cartesian controller.</span>
<span class="sd">            buffer_time : :obj:`float`</span>
<span class="sd">                How much extra time the termination handler will wait</span>
<span class="sd">                before stopping the skill after duration has passed.</span>
<span class="sd">            force_thresholds : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to force limits on translation </span>
<span class="sd">                (xyz) and rotation about (xyz) axes. Default is None. </span>
<span class="sd">                If None then will not stop on contact.</span>
<span class="sd">            torque_thresholds : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to torque limits on each joint. </span>
<span class="sd">                Default is None. If None then will not stop on contact.</span>
<span class="sd">            cartesian_impedances : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to impedances on translation </span>
<span class="sd">                (xyz) and rotation about (xyz) axes. Default is None. </span>
<span class="sd">                If None then will use default impedances.</span>
<span class="sd">            joint_impedances : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to impedances on each joint. </span>
<span class="sd">                This is used when use_impedance is False. Default is None. </span>
<span class="sd">                If None then will use default impedances.</span>
<span class="sd">            block : :obj:`bool`</span>
<span class="sd">                Function blocks by default. If False, the function becomes</span>
<span class="sd">                asynchronous and can be preempted.</span>
<span class="sd">            ignore_errors : :obj:`bool`</span>
<span class="sd">                Function ignores errors by default. If False, errors and </span>
<span class="sd">                some exceptions can be thrown.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on control-pc.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">use_impedance</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_goal_formulation</span><span class="p">:</span>
                <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">ImpedanceControlSkill</span><span class="p">,</span> 
                              <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">GoalPoseDmpTrajectoryGenerator</span><span class="p">,</span>
                              <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">CartesianImpedanceFeedbackController</span><span class="p">,</span>
                              <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">TimeTerminationHandler</span><span class="p">,</span> 
                              <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">ImpedanceControlSkill</span><span class="p">,</span> 
                              <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">PoseDmpTrajectoryGenerator</span><span class="p">,</span>
                              <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">CartesianImpedanceFeedbackController</span><span class="p">,</span>
                              <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">TimeTerminationHandler</span><span class="p">,</span> 
                              <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_goal_formulation</span><span class="p">:</span>
                <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">CartesianPoseSkill</span><span class="p">,</span> 
                              <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">GoalPoseDmpTrajectoryGenerator</span><span class="p">,</span>
                              <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">SetInternalImpedanceFeedbackController</span><span class="p">,</span>
                              <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">TimeTerminationHandler</span><span class="p">,</span> 
                              <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">CartesianPoseSkill</span><span class="p">,</span> 
                              <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">PoseDmpTrajectoryGenerator</span><span class="p">,</span>
                              <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">SetInternalImpedanceFeedbackController</span><span class="p">,</span>
                              <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">TimeTerminationHandler</span><span class="p">,</span> 
                              <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">initial_sensor_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">orientation_only</span> <span class="ow">or</span> <span class="n">position_only</span><span class="p">:</span>
                <span class="n">initial_sensor_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">pose_dmp_info</span><span class="p">[</span><span class="s1">&#39;num_sensors&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">initial_sensor_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">pose_dmp_info</span><span class="p">[</span><span class="s1">&#39;num_sensors&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">add_initial_sensor_values</span><span class="p">(</span><span class="n">initial_sensor_values</span><span class="p">)</span>  <span class="c1"># sensor values</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">add_pose_dmp_params</span><span class="p">(</span><span class="n">orientation_only</span><span class="p">,</span> <span class="n">position_only</span><span class="p">,</span> <span class="n">ee_frame</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">pose_dmp_info</span><span class="p">,</span> <span class="n">initial_sensor_values</span><span class="p">)</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">set_cartesian_impedances</span><span class="p">(</span><span class="n">use_impedance</span><span class="p">,</span> <span class="n">cartesian_impedances</span><span class="p">,</span> <span class="n">joint_impedances</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">skill</span><span class="o">.</span><span class="n">check_for_contact_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">,</span> <span class="n">force_thresholds</span><span class="p">,</span> <span class="n">torque_thresholds</span><span class="p">):</span>
            <span class="n">skill</span><span class="o">.</span><span class="n">add_time_termination_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">)</span>

        <span class="n">goal</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">create_goal</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span>
                        <span class="n">cb</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">skill</span><span class="o">.</span><span class="n">feedback_callback</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                        <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
                        <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrankaArm.execute_quaternion_pose_dmp"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.execute_quaternion_pose_dmp">[docs]</a>    <span class="k">def</span> <span class="nf">execute_quaternion_pose_dmp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                                    <span class="n">position_dmp_info</span><span class="p">,</span>
                                    <span class="n">quat_dmp_info</span><span class="p">,</span>
                                    <span class="n">duration</span><span class="p">,</span>
                                    <span class="n">goal_quat</span><span class="p">,</span>
                                    <span class="n">goal_quat_time</span><span class="p">,</span> 
                                    <span class="n">use_goal_formulation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">initial_sensor_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">ee_frame</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">use_impedance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                    <span class="n">buffer_time</span><span class="o">=</span><span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_TERM_BUFFER_TIME</span><span class="p">,</span>
                                    <span class="n">force_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">torque_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">cartesian_impedances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">joint_impedances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                    <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                    <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;QuaternionPoseDmp&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Commands Arm to execute a given quaternion pose dmp</span>

<span class="sd">        Args:</span>
<span class="sd">            position_dmp_info : :obj:`dict`</span>
<span class="sd">                Contains all the parameters of a position DMP</span>
<span class="sd">                (tau, alpha, beta, num_basis, num_sensors, mu, h, and weights)</span>
<span class="sd">            quat_dmp_info : :obj:`dict`</span>
<span class="sd">                Contains all the parameters of a quaternion DMP</span>
<span class="sd">                (tau, alpha, beta, num_basis, num_sensors, mu, h, and weights)</span>
<span class="sd">            duration : :obj:`float`</span>
<span class="sd">                How much time this robot motion should take.</span>
<span class="sd">            goal_quat : :obj:`list` </span>
<span class="sd">                List of 4 floats that represents the quaternion goal to reach. </span>
<span class="sd">                This assumes an explicit goal formulation for the quaternion DMPs.</span>
<span class="sd">            goal_quat_time : :obj:`float`</span>
<span class="sd">                Time to reach goal for quaternion DMPs.</span>
<span class="sd">            use_goal_formulation : :obj:`bool`</span>
<span class="sd">                Flag that represents whether to use the explicit goal pose dmp formulation.</span>
<span class="sd">            initial_sensor_values : :obj:`list` </span>
<span class="sd">                List of initial sensor values. If None it will default to ones.</span>
<span class="sd">            ee_frame : :obj:`bool`</span>
<span class="sd">                Flag that indicates whether the dmp is in terms of the </span>
<span class="sd">                end-effector frame.</span>
<span class="sd">            use_impedance : :obj:`bool`</span>
<span class="sd">                Function uses our impedance controller by default. If False, </span>
<span class="sd">                uses the Franka cartesian controller.</span>
<span class="sd">            buffer_time : :obj:`float`</span>
<span class="sd">                How much extra time the termination handler will wait</span>
<span class="sd">                before stopping the skill after duration has passed.</span>
<span class="sd">            force_thresholds : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to force limits on translation </span>
<span class="sd">                (xyz) and rotation about (xyz) axes. Default is None. </span>
<span class="sd">                If None then will not stop on contact.</span>
<span class="sd">            torque_thresholds : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to torque limits on each joint. </span>
<span class="sd">                Default is None. If None then will not stop on contact.</span>
<span class="sd">            cartesian_impedances : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to impedances on translation </span>
<span class="sd">                (xyz) and rotation about (xyz) axes. Default is None. </span>
<span class="sd">                If None then will use default impedances.</span>
<span class="sd">            joint_impedances : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to impedances on each joint. </span>
<span class="sd">                This is used when use_impedance is False. Default is None. </span>
<span class="sd">                If None then will use default impedances.</span>
<span class="sd">            block : :obj:`bool`</span>
<span class="sd">                Function blocks by default. If False, the function becomes</span>
<span class="sd">                asynchronous and can be preempted.</span>
<span class="sd">            ignore_errors : :obj:`bool`</span>
<span class="sd">                Function ignores errors by default. If False, errors and some</span>
<span class="sd">                exceptions can be thrown.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on control-pc.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">use_impedance</span><span class="p">:</span>
            <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">ImpedanceControlSkill</span><span class="p">,</span> 
                            <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">QuaternionPoseDmpTrajectoryGenerator</span><span class="p">,</span>
                            <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">CartesianImpedanceFeedbackController</span><span class="p">,</span>
                            <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">TimeTerminationHandler</span><span class="p">,</span> 
                            <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">CartesianPoseSkill</span><span class="p">,</span> 
                            <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">QuaternionPoseDmpTrajectoryGenerator</span><span class="p">,</span>
                            <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">SetInternalImpedanceFeedbackController</span><span class="p">,</span>
                            <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">TimeTerminationHandler</span><span class="p">,</span> 
                            <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">initial_sensor_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">initial_sensor_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">position_dmp_info</span><span class="p">[</span><span class="s1">&#39;num_sensors&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">add_initial_sensor_values</span><span class="p">(</span><span class="n">initial_sensor_values</span><span class="p">)</span>  <span class="c1"># sensor values</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">add_quaternion_pose_dmp_params</span><span class="p">(</span><span class="n">ee_frame</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">position_dmp_info</span><span class="p">,</span> <span class="n">quat_dmp_info</span><span class="p">,</span> <span class="n">initial_sensor_values</span><span class="p">,</span> <span class="n">goal_quat</span><span class="p">,</span> <span class="n">goal_quat_time</span><span class="p">)</span>
        <span class="n">skill</span><span class="o">.</span><span class="n">set_cartesian_impedances</span><span class="p">(</span><span class="n">use_impedance</span><span class="p">,</span> <span class="n">cartesian_impedances</span><span class="p">,</span> <span class="n">joint_impedances</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">skill</span><span class="o">.</span><span class="n">check_for_contact_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">,</span> <span class="n">force_thresholds</span><span class="p">,</span> <span class="n">torque_thresholds</span><span class="p">):</span>
            <span class="n">skill</span><span class="o">.</span><span class="n">add_time_termination_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">)</span>

        <span class="n">goal</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">create_goal</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span>
                        <span class="n">cb</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">skill</span><span class="o">.</span><span class="n">feedback_callback</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                        <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
                        <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrankaArm.apply_effector_forces_torques"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.apply_effector_forces_torques">[docs]</a>    <span class="k">def</span> <span class="nf">apply_effector_forces_torques</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">run_duration</span><span class="p">,</span>
                                      <span class="n">acc_duration</span><span class="p">,</span>
                                      <span class="n">max_translation</span><span class="p">,</span>
                                      <span class="n">max_rotation</span><span class="p">,</span>
                                      <span class="n">forces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                      <span class="n">torques</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                      <span class="n">buffer_time</span><span class="o">=</span><span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_TERM_BUFFER_TIME</span><span class="p">,</span>
                                      <span class="n">force_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                      <span class="n">torque_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                      <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                      <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                      <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;ForceTorque&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies the given end-effector forces and torques in N and Nm</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            run_duration : :obj:`float`</span>
<span class="sd">                How much time this robot motion should take.</span>
<span class="sd">            acc_duration : :obj:`float`</span>
<span class="sd">                How long to acc/de-acc to achieve desired force.</span>
<span class="sd">            max_translation : :obj:`float`</span>
<span class="sd">                A float in the unit of meters. Max translation before the </span>
<span class="sd">                robot deaccelerates.</span>
<span class="sd">            max_rotation : :obj:`float`</span>
<span class="sd">                A float in the unit of rad. Max rotation before the robot</span>
<span class="sd">                deaccelerates.</span>
<span class="sd">            forces : :obj:`list` </span>
<span class="sd">                Optional (defaults to None). A list of 3 numbers that correspond </span>
<span class="sd">                to end-effector forces in (xyz) directions.</span>
<span class="sd">            torques : :obj:`list` </span>
<span class="sd">                Optional (defaults to None). A list of 3 numbers that correspond </span>
<span class="sd">                to end-effector torques in 3 rotational axes.</span>
<span class="sd">            buffer_time : :obj:`float`</span>
<span class="sd">                How much extra time the termination handler will wait</span>
<span class="sd">                before stopping the skill after duration has passed.</span>
<span class="sd">            force_thresholds : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to force limits on translation </span>
<span class="sd">                (xyz) and rotation about (xyz) axes. Default is None. </span>
<span class="sd">                If None then will not stop on contact.</span>
<span class="sd">            torque_thresholds : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to torque limits on each joint. </span>
<span class="sd">                Default is None. If None then will not stop on contact.</span>
<span class="sd">            block : :obj:`bool`</span>
<span class="sd">                Function blocks by default. If False, the function becomes</span>
<span class="sd">                asynchronous and can be preempted.</span>
<span class="sd">            ignore_errors : :obj:`bool`</span>
<span class="sd">                Function ignores errors by default. If False, errors and some </span>
<span class="sd">                exceptions can be thrown.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on control-pc.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError if acc_duration &gt; 0.5*run_duration, or if forces are</span>
<span class="sd">            too large</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">acc_duration</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">run_duration</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;acc_duration must be smaller than half of run_duration!&#39;</span><span class="p">)</span>

        <span class="n">forces</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">forces</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">forces</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">torques</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">torques</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">torques</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">forces</span><span class="p">)</span> <span class="o">*</span> <span class="n">run_duration</span> <span class="o">&gt;</span> <span class="n">FC</span><span class="o">.</span><span class="n">MAX_LIN_MOMENTUM</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Linear momentum magnitude exceeds safety &#39;</span>
                    <span class="s1">&#39;threshold of </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">MAX_LIN_MOMENTUM</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">torques</span><span class="p">)</span> <span class="o">*</span> <span class="n">run_duration</span> <span class="o">&gt;</span> <span class="n">FC</span><span class="o">.</span><span class="n">MAX_ANG_MOMENTUM</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Angular momentum magnitude exceeds safety &#39;</span>
                    <span class="s1">&#39;threshold of </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">MAX_ANG_MOMENTUM</span><span class="p">))</span>

        <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">ForceTorqueSkill</span><span class="p">,</span> 
                      <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">ImpulseTrajectoryGenerator</span><span class="p">,</span>
                      <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">PassThroughFeedbackController</span><span class="p">,</span>
                      <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">TimeTerminationHandler</span><span class="p">,</span> 
                      <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">add_initial_sensor_values</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">EMPTY_SENSOR_VALUES</span><span class="p">)</span>
        
        <span class="n">skill</span><span class="o">.</span><span class="n">add_impulse_params</span><span class="p">(</span><span class="n">run_duration</span><span class="p">,</span> <span class="n">acc_duration</span><span class="p">,</span> <span class="n">max_translation</span><span class="p">,</span> <span class="n">max_rotation</span><span class="p">,</span> <span class="n">forces</span><span class="p">,</span> <span class="n">torques</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">skill</span><span class="o">.</span><span class="n">check_for_contact_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">,</span> <span class="n">force_thresholds</span><span class="p">,</span> <span class="n">torque_thresholds</span><span class="p">):</span>
            <span class="n">skill</span><span class="o">.</span><span class="n">add_time_termination_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">)</span>

        <span class="n">goal</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">create_goal</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span>
                        <span class="n">cb</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">skill</span><span class="o">.</span><span class="n">feedback_callback</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                        <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
                        <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrankaArm.apply_effector_forces_along_axis"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.apply_effector_forces_along_axis">[docs]</a>    <span class="k">def</span> <span class="nf">apply_effector_forces_along_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="n">run_duration</span><span class="p">,</span>
                                         <span class="n">acc_duration</span><span class="p">,</span>
                                         <span class="n">max_translation</span><span class="p">,</span>
                                         <span class="n">forces</span><span class="p">,</span>
                                         <span class="n">buffer_time</span><span class="o">=</span><span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_TERM_BUFFER_TIME</span><span class="p">,</span>
                                         <span class="n">force_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">torque_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                         <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                         <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;ForcesAlongAxis&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies the given end-effector forces and torques in N and Nm</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            run_duration : :obj:`float`</span>
<span class="sd">                How much time this robot motion should take.</span>
<span class="sd">            acc_duration : :obj:`float`</span>
<span class="sd">                How long to acc/de-acc to achieve desired force.</span>
<span class="sd">            max_translation : :obj:`float`</span>
<span class="sd">                A float in the unit of meters. Max translation before the </span>
<span class="sd">                robot deaccelerates.</span>
<span class="sd">            forces : :obj:`list` </span>
<span class="sd">                Optional (defaults to None). A list of 3 numbers that correspond </span>
<span class="sd">                to the magnitude of the end-effector forces and the axis.</span>
<span class="sd">            buffer_time : :obj:`float`</span>
<span class="sd">                How much extra time the termination handler will wait</span>
<span class="sd">                before stopping the skill after duration has passed.</span>
<span class="sd">            force_thresholds : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to force limits on translation </span>
<span class="sd">                (xyz) and rotation about (xyz) axes. Default is None. </span>
<span class="sd">                If None then will not stop on contact.</span>
<span class="sd">            torque_thresholds : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to torque limits on each joint. </span>
<span class="sd">                Default is None. If None then will not stop on contact.</span>
<span class="sd">            block : :obj:`bool`</span>
<span class="sd">                Function blocks by default. If False, the function becomes</span>
<span class="sd">                asynchronous and can be preempted.</span>
<span class="sd">            ignore_errors : :obj:`bool`</span>
<span class="sd">                Function ignores errors by default. If False, errors and some </span>
<span class="sd">                exceptions can be thrown.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on control-pc.</span>
<span class="sd">                    </span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError if acc_duration &gt; 0.5*run_duration, or if forces are</span>
<span class="sd">            too large</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">acc_duration</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">run_duration</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;acc_duration must be smaller than half of run_duration!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">forces</span><span class="p">)</span> <span class="o">*</span> <span class="n">run_duration</span> <span class="o">&gt;</span> <span class="n">FC</span><span class="o">.</span><span class="n">MAX_LIN_MOMENTUM_CONSTRAINED</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Linear momentum magnitude exceeds safety &#39;</span> \
                    <span class="s1">&#39;threshold of </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">MAX_LIN_MOMENTUM_CONSTRAINED</span><span class="p">))</span>

        <span class="n">forces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">forces</span><span class="p">)</span>
        <span class="n">force_axis</span> <span class="o">=</span> <span class="n">forces</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">forces</span><span class="p">)</span>

        <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">ForceTorqueSkill</span><span class="p">,</span> 
                      <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">ImpulseTrajectoryGenerator</span><span class="p">,</span>
                      <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">ForceAxisImpedenceFeedbackController</span><span class="p">,</span>
                      <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">TimeTerminationHandler</span><span class="p">,</span> 
                      <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">add_initial_sensor_values</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">EMPTY_SENSOR_VALUES</span><span class="p">)</span>
        
        <span class="n">skill</span><span class="o">.</span><span class="n">add_impulse_params</span><span class="p">(</span><span class="n">run_duration</span><span class="p">,</span> <span class="n">acc_duration</span><span class="p">,</span> <span class="n">max_translation</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">forces</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">add_force_axis_params</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_FORCE_AXIS_TRANSLATIONAL_STIFFNESS</span><span class="p">,</span>
                                    <span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_FORCE_AXIS_ROTATIONAL_STIFFNESS</span><span class="p">,</span>
                                    <span class="n">force_axis</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">skill</span><span class="o">.</span><span class="n">check_for_contact_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">,</span> <span class="n">force_thresholds</span><span class="p">,</span> <span class="n">torque_thresholds</span><span class="p">):</span>
            <span class="n">skill</span><span class="o">.</span><span class="n">add_time_termination_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">)</span>

        <span class="n">goal</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">create_goal</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span>
                        <span class="n">cb</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">skill</span><span class="o">.</span><span class="n">feedback_callback</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                        <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
                        <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrankaArm.goto_gripper"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.goto_gripper">[docs]</a>    <span class="k">def</span> <span class="nf">goto_gripper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                     <span class="n">width</span><span class="p">,</span> 
                     <span class="n">grasp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                     <span class="n">speed</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> 
                     <span class="n">force</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                     <span class="n">epsilon_inner</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span>
                     <span class="n">epsilon_outer</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> 
                     <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                     <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                     <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;GoToGripper&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Commands gripper to goto a certain width, applying up to the given</span>
<span class="sd">            (default is max) force if needed</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            width : :obj:`float`</span>
<span class="sd">                Desired width of the gripper in the unit of meters.</span>
<span class="sd">            grasp : :obj:`bool`</span>
<span class="sd">                Flag that signals whether to grasp.</span>
<span class="sd">            speed : :obj:`float`</span>
<span class="sd">                Gripper operation speed in meters per sec.</span>
<span class="sd">            force : :obj:`float`</span>
<span class="sd">                Max gripper force to apply in N. Default to None,</span>
<span class="sd">                which gives acceptable force.</span>
<span class="sd">            epsilon_inner : :obj:`float`</span>
<span class="sd">                Max tolerated deviation when the actual grasped </span>
<span class="sd">                width is smaller than the commanded grasp width.</span>
<span class="sd">            epsilon_outer : :obj:`float`</span>
<span class="sd">                Max tolerated deviation when the actual grasped </span>
<span class="sd">                width is larger than the commanded grasp width.</span>
<span class="sd">            block : :obj:`bool`</span>
<span class="sd">                Function blocks by default. If False, the function </span>
<span class="sd">                becomes asynchronous and can be preempted.</span>
<span class="sd">            ignore_errors : :obj:`bool`</span>
<span class="sd">                Function ignores errors by default. If False, errors </span>
<span class="sd">                and some exceptions can be thrown.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on control-pc.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If width is less than 0 or greater than TODO(jacky)</span>
<span class="sd">                the maximum gripper opening</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;</span> <span class="n">FC</span><span class="o">.</span><span class="n">GRIPPER_WIDTH_MIN</span> <span class="ow">or</span> <span class="n">width</span> <span class="o">&gt;</span> <span class="n">FC</span><span class="o">.</span><span class="n">GRIPPER_WIDTH_MAX</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;gripper width must be within the gripper limits of &#39;</span> \
                    <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> and </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">GRIPPER_WIDTH_MIN</span><span class="p">,</span><span class="n">FC</span><span class="o">.</span><span class="n">GRIPPER_WIDTH_MAX</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_old_gripper</span><span class="p">:</span>
            <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">GripperSkill</span><span class="p">,</span> 
                          <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">GripperTrajectoryGenerator</span><span class="p">,</span> 
                          <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>

            <span class="n">skill</span><span class="o">.</span><span class="n">add_initial_sensor_values</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">EMPTY_SENSOR_VALUES</span><span class="p">)</span>

            <span class="n">skill</span><span class="o">.</span><span class="n">add_gripper_params</span><span class="p">(</span><span class="n">grasp</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>

            <span class="n">goal</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">create_goal</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span>
                            <span class="n">cb</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">skill</span><span class="o">.</span><span class="n">feedback_callback</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                            <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
                            <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span>
            <span class="c1"># this is so the gripper state can be updated, which happens with a</span>
            <span class="c1"># small lag</span>
            <span class="n">sleep</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">GRIPPER_CMD_SLEEP_TIME</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">grasp</span><span class="p">:</span>
                <span class="n">grasp_skill</span> <span class="o">=</span> <span class="n">GraspGoal</span><span class="p">()</span>
                <span class="n">grasp_skill</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
                <span class="n">grasp_skill</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span>
                <span class="n">grasp_skill</span><span class="o">.</span><span class="n">force</span> <span class="o">=</span> <span class="n">force</span>
                <span class="n">grasp_skill</span><span class="o">.</span><span class="n">epsilon</span><span class="o">.</span><span class="n">inner</span> <span class="o">=</span> <span class="n">epsilon_inner</span>
                <span class="n">grasp_skill</span><span class="o">.</span><span class="n">epsilon</span><span class="o">.</span><span class="n">outer</span> <span class="o">=</span> <span class="n">epsilon_outer</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_grasp_client</span><span class="o">.</span><span class="n">send_goal</span><span class="p">(</span><span class="n">grasp_skill</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">move_skill</span> <span class="o">=</span> <span class="n">MoveGoal</span><span class="p">()</span>
                <span class="n">move_skill</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
                <span class="n">move_skill</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_move_client</span><span class="o">.</span><span class="n">send_goal</span><span class="p">(</span><span class="n">move_skill</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_gripper</span><span class="p">()</span></div>

<div class="viewcode-block" id="FrankaArm.selective_guidance_mode"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.selective_guidance_mode">[docs]</a>    <span class="k">def</span> <span class="nf">selective_guidance_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                                <span class="n">duration</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                <span class="n">use_joints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                <span class="n">use_impedance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">use_ee_frame</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">buffer_time</span><span class="o">=</span><span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_TERM_BUFFER_TIME</span><span class="p">,</span>
                                <span class="n">force_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">torque_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">cartesian_impedances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">joint_impedances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">k_gains</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">d_gains</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">ignore_virtual_walls</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;SelectiveGuidance&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Commands the Arm to stay in its current position with selective impedances</span>
<span class="sd">        that allow guidance in either certain joints or in cartesian pose.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            duration : :obj:`float`</span>
<span class="sd">                How much time this guidance should take</span>
<span class="sd">            use_joints : :obj:`bool`</span>
<span class="sd">                Function uses cartesian impedance controller by default. </span>
<span class="sd">                If True, it uses joint impedance.</span>
<span class="sd">            use_impedance : :obj:`bool`</span>
<span class="sd">                Function uses the Franka joint impedance controller by default. </span>
<span class="sd">                If True, uses our joint impedance controller.</span>
<span class="sd">            use_ee_frame : :obj:`bool`</span>
<span class="sd">                Function uses the end-effector cartesian feedback controller</span>
<span class="sd">                only when use_impedance is True.</span>
<span class="sd">            buffer_time : :obj:`float`</span>
<span class="sd">                How much extra time the termination handler will wait</span>
<span class="sd">                before stopping the skill after duration has passed.</span>
<span class="sd">            force_thresholds : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to force limits on translation </span>
<span class="sd">                (xyz) and rotation about (xyz) axes. Default is None. </span>
<span class="sd">                If None then will not stop on contact.</span>
<span class="sd">            torque_thresholds : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to torque limits on each joint. </span>
<span class="sd">                Default is None. If None then will not stop on contact.</span>
<span class="sd">            cartesian_impedances : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to impedances on translation </span>
<span class="sd">                (xyz) and rotation about (xyz) axes. Default is None. </span>
<span class="sd">                If None then will use default impedances.</span>
<span class="sd">            joint_impedances : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to impedances on each joint. </span>
<span class="sd">                This is used when use_impedance is False. Default is None. </span>
<span class="sd">                If None then will use default impedances.</span>
<span class="sd">            k_gains : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to the k_gains on each joint</span>
<span class="sd">                for our impedance controller. This is used when use_impedance is </span>
<span class="sd">                True. Default is None. If None then will use default k_gains.</span>
<span class="sd">            d_gains : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to the d_gains on each joint</span>
<span class="sd">                for our impedance controller. This is used when use_impedance is </span>
<span class="sd">                True. Default is None. If None then will use default d_gains.</span>
<span class="sd">            block : :obj:`bool`</span>
<span class="sd">                Function blocks by default. If False, the function becomes</span>
<span class="sd">                asynchronous and can be preempted.</span>
<span class="sd">            ignore_errors : :obj:`bool`</span>
<span class="sd">                Function ignores errors by default. If False, errors and some </span>
<span class="sd">                exceptions can be thrown.</span>
<span class="sd">            ignore_virtual_walls : :obj:`bool`</span>
<span class="sd">                Function checks for collisions with virtual walls by default. </span>
<span class="sd">                If False, the robot no longer checks, which may be dangerous.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on control-pc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">use_joints</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_impedance</span><span class="p">:</span>
                <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">ImpedanceControlSkill</span><span class="p">,</span> 
                              <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">StayInInitialJointsTrajectoryGenerator</span><span class="p">,</span>
                              <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">JointImpedanceFeedbackController</span><span class="p">,</span>
                              <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">FinalJointTerminationHandler</span><span class="p">,</span> 
                              <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">JointPositionSkill</span><span class="p">,</span> 
                              <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">StayInInitialJointsTrajectoryGenerator</span><span class="p">,</span>
                              <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">SetInternalImpedanceFeedbackController</span><span class="p">,</span>
                              <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">FinalJointTerminationHandler</span><span class="p">,</span> 
                              <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_impedance</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">use_ee_frame</span><span class="p">:</span>
                    <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">ImpedanceControlSkill</span><span class="p">,</span> 
                                  <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">StayInInitialPoseTrajectoryGenerator</span><span class="p">,</span>
                                  <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">EECartesianImpedanceFeedbackController</span><span class="p">,</span>
                                  <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">TimeTerminationHandler</span><span class="p">,</span> 
                                  <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">ImpedanceControlSkill</span><span class="p">,</span> 
                                  <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">StayInInitialPoseTrajectoryGenerator</span><span class="p">,</span>
                                  <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">CartesianImpedanceFeedbackController</span><span class="p">,</span>
                                  <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">TimeTerminationHandler</span><span class="p">,</span> 
                                  <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">CartesianPoseSkill</span><span class="p">,</span> 
                              <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">StayInInitialPoseTrajectoryGenerator</span><span class="p">,</span>
                              <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">SetInternalImpedanceFeedbackController</span><span class="p">,</span>
                              <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">TimeTerminationHandler</span><span class="p">,</span> 
                              <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">add_initial_sensor_values</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">EMPTY_SENSOR_VALUES</span><span class="p">)</span>
        
        <span class="n">skill</span><span class="o">.</span><span class="n">add_run_time</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">use_joints</span><span class="p">:</span>
            <span class="n">skill</span><span class="o">.</span><span class="n">set_joint_impedances</span><span class="p">(</span><span class="n">use_impedance</span><span class="p">,</span> <span class="n">cartesian_impedances</span><span class="p">,</span> <span class="n">joint_impedances</span><span class="p">,</span> <span class="n">k_gains</span><span class="p">,</span> <span class="n">d_gains</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">skill</span><span class="o">.</span><span class="n">set_cartesian_impedances</span><span class="p">(</span><span class="n">use_impedance</span><span class="p">,</span> <span class="n">cartesian_impedances</span><span class="p">,</span> <span class="n">joint_impedances</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">skill</span><span class="o">.</span><span class="n">check_for_contact_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">,</span> <span class="n">force_thresholds</span><span class="p">,</span> <span class="n">torque_thresholds</span><span class="p">):</span>
            <span class="n">skill</span><span class="o">.</span><span class="n">add_time_termination_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">)</span>

        <span class="n">goal</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">create_goal</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span>
                        <span class="n">cb</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">skill</span><span class="o">.</span><span class="n">feedback_callback</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                        <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
                        <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrankaArm.open_gripper"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.open_gripper">[docs]</a>    <span class="k">def</span> <span class="nf">open_gripper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;OpenGripper&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens gripper to maximum width</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            block : :obj:`bool`</span>
<span class="sd">                Function blocks by default. If False, the function becomes</span>
<span class="sd">                asynchronous and can be preempted.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on control-pc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_gripper</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">GRIPPER_WIDTH_MAX</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span> <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrankaArm.close_gripper"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.close_gripper">[docs]</a>    <span class="k">def</span> <span class="nf">close_gripper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grasp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;CloseGripper&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes the gripper as much as possible</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            grasp : :obj:`bool`</span>
<span class="sd">                Flag that signals whether to grasp.</span>
<span class="sd">            block : :obj:`bool`</span>
<span class="sd">                Function blocks by default. If False, the function becomes</span>
<span class="sd">                asynchronous and can be preempted.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on control-pc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_gripper</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">GRIPPER_WIDTH_MIN</span><span class="p">,</span> <span class="n">grasp</span><span class="o">=</span><span class="n">grasp</span><span class="p">,</span>
                          <span class="n">force</span><span class="o">=</span><span class="n">FC</span><span class="o">.</span><span class="n">GRIPPER_MAX_FORCE</span> <span class="k">if</span> <span class="n">grasp</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span> <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrankaArm.home_gripper"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.home_gripper">[docs]</a>    <span class="k">def</span> <span class="nf">home_gripper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;HomeGripper&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Homes the gripper.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            block : :obj:`bool`</span>
<span class="sd">                Function blocks by default. If False, the function becomes</span>
<span class="sd">                asynchronous and can be preempted.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on control-pc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_gripper_command</span> <span class="o">=</span> <span class="s1">&#39;Homing&#39;</span>
        <span class="n">homing_skill</span> <span class="o">=</span> <span class="n">HomingGoal</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_homing_client</span><span class="o">.</span><span class="n">send_goal</span><span class="p">(</span><span class="n">homing_skill</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_gripper</span><span class="p">()</span></div>

<div class="viewcode-block" id="FrankaArm.stop_gripper"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.stop_gripper">[docs]</a>    <span class="k">def</span> <span class="nf">stop_gripper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;StopGripper&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stops the gripper.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            block : :obj:`bool`</span>
<span class="sd">                Function blocks by default. If False, the function becomes</span>
<span class="sd">                asynchronous and can be preempted.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on control-pc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_gripper_command</span> <span class="o">=</span> <span class="s1">&#39;Stop&#39;</span>
        <span class="n">stop_skill</span> <span class="o">=</span> <span class="n">StopGoal</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_stop_client</span><span class="o">.</span><span class="n">send_goal</span><span class="p">(</span><span class="n">stop_skill</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_gripper</span><span class="p">()</span></div>

<div class="viewcode-block" id="FrankaArm.run_guide_mode"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.run_guide_mode">[docs]</a>    <span class="k">def</span> <span class="nf">run_guide_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;GuideMode&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs guide mode which allows you to move the robot freely.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            duration : :obj:`float`</span>
<span class="sd">                How much time this guidance should take</span>
<span class="sd">            block : :obj:`bool`</span>
<span class="sd">                Function blocks by default. If False, the function becomes</span>
<span class="sd">                asynchronous and can be preempted.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on control-pc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_effector_forces_torques</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span> <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrankaArm.run_dynamic_force_position"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.run_dynamic_force_position">[docs]</a>    <span class="k">def</span> <span class="nf">run_dynamic_force_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">duration</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                  <span class="n">buffer_time</span><span class="o">=</span><span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_TERM_BUFFER_TIME</span><span class="p">,</span>
                  <span class="n">force_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">torque_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">position_kps_cart</span><span class="o">=</span><span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_TRANSLATIONAL_STIFFNESSES</span> <span class="o">+</span> <span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_ROTATIONAL_STIFFNESSES</span><span class="p">,</span>
                  <span class="n">force_kps_cart</span><span class="o">=</span><span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_HFPC_FORCE_GAIN</span><span class="p">,</span>
                  <span class="n">position_kps_joint</span><span class="o">=</span><span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_K_GAINS</span><span class="p">,</span>
                  <span class="n">force_kps_joint</span><span class="o">=</span><span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_HFPC_FORCE_GAIN</span><span class="p">,</span>
                  <span class="n">S</span><span class="o">=</span><span class="n">FC</span><span class="o">.</span><span class="n">DEFAULT_HFPC_S</span><span class="p">,</span>
                  <span class="n">interpolate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">use_cartesian_gains</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">ignore_virtual_walls</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Commands Arm to run dynamic hybrid force position control</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            duration : :obj:`float`</span>
<span class="sd">                How much time this robot motion should take.</span>
<span class="sd">            use_impedance : :obj:`bool`</span>
<span class="sd">                Function uses our impedance controller by default. </span>
<span class="sd">                If False, uses the Franka cartesian controller.</span>
<span class="sd">            buffer_time : :obj:`float`</span>
<span class="sd">                How much extra time the termination handler will wait</span>
<span class="sd">                before stopping the skill after duration has passed.</span>
<span class="sd">            force_thresholds : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to force limits on translation </span>
<span class="sd">                (xyz) and rotation about (xyz) axes. Default is None. </span>
<span class="sd">                If None then will not stop on contact.</span>
<span class="sd">            torque_thresholds : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to torque limits on each joint. </span>
<span class="sd">                Default is None. If None then will not stop on contact.</span>
<span class="sd">            position_kp_cart : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to proportional gain used for </span>
<span class="sd">                position errors in cartesian space.</span>
<span class="sd">            force_kp_cart : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to proportional gain used for </span>
<span class="sd">                force errors in cartesian space.</span>
<span class="sd">            position_kp_joint : :obj:`list` </span>
<span class="sd">                List of 7 floats corresponding to proportional gain used for </span>
<span class="sd">                position errors in joint space.</span>
<span class="sd">            force_kp_joint : :obj:`list` </span>
<span class="sd">                List of 6 floats corresponding to proportional gain used for </span>
<span class="sd">                force errors in joint space.</span>
<span class="sd">            S : :obj:`list` </span>
<span class="sd">                List of 6 numbers between 0 and 1 for the HFPC selection matrix.</span>
<span class="sd">            interpolate : :obj:`bool`</span>
<span class="sd">                Whether or not to perform linear interpolation in between way points.</span>
<span class="sd">            use_cartesian_gains : :obj:`bool`</span>
<span class="sd">                Whether to use cartesian gains or joint gains.</span>
<span class="sd">            ignore_errors : :obj:`bool`</span>
<span class="sd">                Function ignores errors by default. If False, errors and some </span>
<span class="sd">                exceptions can be thrown.</span>
<span class="sd">            ignore_virtual_walls : :obj:`bool`</span>
<span class="sd">                Function checks for collisions with virtual walls by default. </span>
<span class="sd">                If False, the robot no longer checks, which may be dangerous.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on control-pc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">interpolate</span><span class="p">:</span>
            <span class="n">traj_gen</span> <span class="o">=</span> <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">LinearForcePositionTrajectoryGenerator</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">traj_gen</span> <span class="o">=</span> <span class="n">TrajectoryGeneratorType</span><span class="o">.</span><span class="n">PassThroughForcePositionTrajectoryGenerator</span>
        <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="p">(</span><span class="n">SkillType</span><span class="o">.</span><span class="n">ForceTorqueSkill</span><span class="p">,</span> 
                        <span class="n">traj_gen</span><span class="p">,</span>
                        <span class="n">feedback_controller_type</span><span class="o">=</span><span class="n">FeedbackControllerType</span><span class="o">.</span><span class="n">ForcePositionFeedbackController</span><span class="p">,</span>
                        <span class="n">termination_handler_type</span><span class="o">=</span><span class="n">TerminationHandlerType</span><span class="o">.</span><span class="n">TimeTerminationHandler</span><span class="p">,</span> 
                        <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">)</span>

        <span class="n">skill</span><span class="o">.</span><span class="n">add_initial_sensor_values</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">EMPTY_SENSOR_VALUES</span><span class="p">)</span>
        <span class="n">skill</span><span class="o">.</span><span class="n">add_force_position_params</span><span class="p">(</span><span class="n">position_kps_cart</span><span class="p">,</span> <span class="n">force_kps_cart</span><span class="p">,</span> <span class="n">position_kps_joint</span><span class="p">,</span> <span class="n">force_kps_joint</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">use_cartesian_gains</span><span class="p">)</span>
        <span class="n">skill</span><span class="o">.</span><span class="n">add_run_time</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">skill</span><span class="o">.</span><span class="n">check_for_contact_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">,</span> <span class="n">force_thresholds</span><span class="p">,</span> <span class="n">torque_thresholds</span><span class="p">):</span>
            <span class="n">skill</span><span class="o">.</span><span class="n">add_time_termination_params</span><span class="p">(</span><span class="n">buffer_time</span><span class="p">)</span>
            
        <span class="n">goal</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">create_goal</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span>
                        <span class="n">cb</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">skill</span><span class="o">.</span><span class="n">feedback_callback</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                        <span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span>

        <span class="n">sleep</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">DYNAMIC_SKILL_WAIT_TIME</span><span class="p">)</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FrankaArm.get_robot_state"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.get_robot_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_robot_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            robot_state : :obj:`dict`</span>
<span class="sd">                Dict that contains all of the robot&#39;s current</span>
<span class="sd">                state information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_client</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span></div>

<div class="viewcode-block" id="FrankaArm.get_pose"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.get_pose">[docs]</a>    <span class="k">def</span> <span class="nf">get_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_tool_offset</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            pose : :obj:`autolab_core.RigidTransform`</span>
<span class="sd">                Current pose of the end-effector including the transform</span>
<span class="sd">                to the end of the tool.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tool_base_pose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_client</span><span class="o">.</span><span class="n">get_pose</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">include_tool_offset</span><span class="p">:</span>
            <span class="n">tool_pose</span> <span class="o">=</span> <span class="n">tool_base_pose</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tool_delta_pose</span>
            <span class="k">return</span> <span class="n">tool_pose</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tool_base_pose</span></div>

<div class="viewcode-block" id="FrankaArm.get_joints"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.get_joints">[docs]</a>    <span class="k">def</span> <span class="nf">get_joints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current joint positions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            joint_positions : :obj:`numpy.ndarray`</span>
<span class="sd">                7 floats that represent each joint&#39;s position in radians.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_client</span><span class="o">.</span><span class="n">get_joints</span><span class="p">()</span></div>

<div class="viewcode-block" id="FrankaArm.get_joint_torques"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.get_joint_torques">[docs]</a>    <span class="k">def</span> <span class="nf">get_joint_torques</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current joint torques.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            joint_torques : :obj:`numpy.ndarray`</span>
<span class="sd">                7 floats that represent each joint&#39;s torque in Nm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_client</span><span class="o">.</span><span class="n">get_joint_torques</span><span class="p">()</span></div>

<div class="viewcode-block" id="FrankaArm.get_joint_velocities"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.get_joint_velocities">[docs]</a>    <span class="k">def</span> <span class="nf">get_joint_velocities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current joint velocities.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            joint_velocities : :obj:`numpy.ndarray`</span>
<span class="sd">                7 floats that represent each joint&#39;s velocity in rads/s.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_client</span><span class="o">.</span><span class="n">get_joint_velocities</span><span class="p">()</span></div>

<div class="viewcode-block" id="FrankaArm.get_gripper_width"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.get_gripper_width">[docs]</a>    <span class="k">def</span> <span class="nf">get_gripper_width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current gripper width.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            gripper_width : :obj:`float`</span>
<span class="sd">                Robot gripper width in meters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_old_gripper</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_client</span><span class="o">.</span><span class="n">get_gripper_width</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gripper_data</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">wait_for_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gripper_joint_states_name</span><span class="p">,</span> <span class="n">JointState</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">gripper_data</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">gripper_data</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="FrankaArm.get_gripper_is_grasped"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.get_gripper_is_grasped">[docs]</a>    <span class="k">def</span> <span class="nf">get_gripper_is_grasped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a flag that represents if the gripper is grasping something.</span>

<span class="sd">        WARNING: THIS FUNCTION HAS BEEN DEPRECATED WHEN WE SWITCHED</span>
<span class="sd">        TO THE FRANKA_ROS GRIPPER CONTROLLER BECAUSE IT DOES NOT PUBLISH</span>
<span class="sd">        THE IS GRASPED FLAG. YOU WILL NEED TO DETERMINE WHEN THE ROBOT</span>
<span class="sd">        IS GRASPING AN ITEM YOURSELF USING THE GRIPPER WIDTH.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            is_grasped : :obj:`bool`</span>
<span class="sd">                Returns True if gripper is grasping something. False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_client</span><span class="o">.</span><span class="n">get_gripper_is_grasped</span><span class="p">()</span></div>

<div class="viewcode-block" id="FrankaArm.get_tool_base_pose"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.get_tool_base_pose">[docs]</a>    <span class="k">def</span> <span class="nf">get_tool_base_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the tool delta pose.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            tool_delta_pose : :obj:`autolab_core.RigidTransform`</span>
<span class="sd">                RigidTransform that represents the transform between the </span>
<span class="sd">                end-effector and the end of the tool.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tool_delta_pose</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="FrankaArm.get_ee_force_torque"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.get_ee_force_torque">[docs]</a>    <span class="k">def</span> <span class="nf">get_ee_force_torque</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current end-effector&#39;s sensed force_torque.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            ee_force_torque : :obj:`numpy.ndarray`</span>
<span class="sd">                A numpy ndarray of 6 floats that represents the current</span>
<span class="sd">                end-effector&#39;s sensed force_torque.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_client</span><span class="o">.</span><span class="n">get_ee_force_torque</span><span class="p">()</span></div>

<div class="viewcode-block" id="FrankaArm.get_finger_poses"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.get_finger_poses">[docs]</a>    <span class="k">def</span> <span class="nf">get_finger_poses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current poses of the left and right fingers.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            left_finger_pose : :obj:`autolab_core.RigidTransform`</span>
<span class="sd">                RigidTransform that represents the transform of the left finger.</span>
<span class="sd">                The left finger is +y from the gripper pose</span>
<span class="sd">            right_finger_pose : :obj:`autolab_core.RigidTransform`</span>
<span class="sd">                RigidTransform that represents the transform of the right finger.</span>
<span class="sd">                The right finger is -y from the gripper pose</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ee_pose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pose</span><span class="p">()</span>
        <span class="n">delta_gripper_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_gripper_width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">left_finger_pose</span> <span class="o">=</span> <span class="n">ee_pose</span> <span class="o">*</span> <span class="n">RigidTransform</span><span class="p">(</span>
            <span class="n">translation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">delta_gripper_width</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
            <span class="n">from_frame</span><span class="o">=</span><span class="s1">&#39;finger_left&#39;</span><span class="p">,</span> <span class="n">to_frame</span><span class="o">=</span><span class="n">ee_pose</span><span class="o">.</span><span class="n">from_frame</span>
        <span class="p">)</span>
        <span class="n">right_finger_pose</span> <span class="o">=</span> <span class="n">ee_pose</span> <span class="o">*</span> <span class="n">RigidTransform</span><span class="p">(</span>
            <span class="n">translation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">delta_gripper_width</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
            <span class="n">from_frame</span><span class="o">=</span><span class="s1">&#39;finger_right&#39;</span><span class="p">,</span> <span class="n">to_frame</span><span class="o">=</span><span class="n">ee_pose</span><span class="o">.</span><span class="n">from_frame</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">left_finger_pose</span><span class="p">,</span> <span class="n">right_finger_pose</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FrankaArm.set_tool_delta_pose"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.set_tool_delta_pose">[docs]</a>    <span class="k">def</span> <span class="nf">set_tool_delta_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_delta_pose</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the tool pose relative to the end-effector pose</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            tool_delta_pose : :obj:`autolab_core.RigidTransform`</span>
<span class="sd">                RigidTransform that represents the transform between the </span>
<span class="sd">                end-effector and the end of the tool.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tool_delta_pose</span><span class="o">.</span><span class="n">from_frame</span> <span class="o">!=</span> <span class="s1">&#39;franka_tool&#39;</span> \
                <span class="ow">or</span> <span class="n">tool_delta_pose</span><span class="o">.</span><span class="n">to_frame</span> <span class="o">!=</span> <span class="s1">&#39;franka_tool_base&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;tool_delta_pose has invalid frame names! &#39;</span> \
                             <span class="s1">&#39;Make sure it has from_frame=franka_tool, and &#39;</span> \
                             <span class="s1">&#39;to_frame=franka_tool_base&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tool_delta_pose</span> <span class="o">=</span> <span class="n">tool_delta_pose</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Forward Kinematics, Jacobian, other offline methods</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_dh_alpha_rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">_dh_a_trans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">_dh_d_trans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">_dh_theta_rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                        <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<div class="viewcode-block" id="FrankaArm.get_links_transforms"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.get_links_transforms">[docs]</a>    <span class="k">def</span> <span class="nf">get_links_transforms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joints</span><span class="p">,</span> <span class="n">use_rigid_transforms</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Computes the forward kinematics of all links and the end-effector</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            joints : :obj:`list` </span>
<span class="sd">                A list of 7 numbers that correspond to to the joint angles in radians</span>
<span class="sd">            use_rigid_transforms : :obj:`bool`  </span>
<span class="sd">                Optional: Defaults to False.</span>
<span class="sd">                If True, converts result to RigidTransform objects. This is slower.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            transforms : :obj:`list` </span>
<span class="sd">                A list of 9 RigidTransforms or ndarrays in panda_link0 to panda_link7, </span>
<span class="sd">                the franka_tool_base, and franka_tool frames.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transforms_matrices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">DH_PARAMS</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">prev_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">DH_PARAMS</span><span class="p">)):</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">FC</span><span class="o">.</span><span class="n">DH_PARAMS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">FC</span><span class="o">.</span><span class="n">N_REV_JOINTS</span><span class="p">:</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">+</span> <span class="n">joints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">ca</span><span class="p">,</span> <span class="n">sa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">ct</span><span class="p">,</span> <span class="n">st</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dh_alpha_rot</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ca</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dh_alpha_rot</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sa</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dh_alpha_rot</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sa</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dh_alpha_rot</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ca</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_dh_a_trans</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dh_d_trans</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_dh_theta_rot</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ct</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dh_theta_rot</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">st</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dh_theta_rot</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dh_theta_rot</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ct</span>

            <span class="n">delta_transform_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dh_alpha_rot</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dh_a_trans</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dh_d_trans</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dh_theta_rot</span>

            <span class="n">transforms_matrices</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_transform</span> <span class="o">@</span> <span class="n">delta_transform_matrix</span>
            <span class="n">prev_transform</span> <span class="o">=</span> <span class="n">transforms_matrices</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">transforms_matrices</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">transforms_matrices</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">transforms_matrices</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">transforms_matrices</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tool_delta_pose</span><span class="o">.</span><span class="n">matrix</span>

        <span class="n">rigid_transforms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">use_rigid_transforms</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
                <span class="n">rigid_transforms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">RigidTransform</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="n">transforms_matrices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">translation</span><span class="o">=</span><span class="n">transforms_matrices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                        <span class="n">from_frame</span><span class="o">=</span><span class="s1">&#39;panda_link</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">to_frame</span><span class="o">=</span><span class="s1">&#39;world&#39;</span>
                    <span class="p">))</span>

            <span class="n">rigid_transforms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">RigidTransform</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="n">transforms_matrices</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">translation</span><span class="o">=</span><span class="n">transforms_matrices</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                    <span class="n">from_frame</span><span class="o">=</span><span class="s1">&#39;panda_hand&#39;</span><span class="p">,</span> <span class="n">to_frame</span><span class="o">=</span><span class="s1">&#39;world&#39;</span>
                <span class="p">))</span>

            <span class="n">transform_tool_base</span> <span class="o">=</span> <span class="n">rigid_transforms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">as_frames</span><span class="p">(</span><span class="n">from_frame</span><span class="o">=</span><span class="s1">&#39;franka_tool_base&#39;</span><span class="p">)</span>
            <span class="n">transform_tool</span> <span class="o">=</span> <span class="n">transform_tool_base</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tool_delta_pose</span>

            <span class="n">rigid_transforms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transform_tool_base</span><span class="p">)</span>
            <span class="n">rigid_transforms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transform_tool</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">rigid_transforms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">transforms_matrices</span></div>

<div class="viewcode-block" id="FrankaArm.get_jacobian"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.get_jacobian">[docs]</a>    <span class="k">def</span> <span class="nf">get_jacobian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joints</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Computes the analytical jacobian</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            joints : :obj:`list` </span>
<span class="sd">                A list of 7 numbers that correspond to the joint angles in radians.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            jacobian : :obj:`numpy.ndarray`</span>
<span class="sd">                A 6 by 7 jacobian matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transforms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_links_transforms</span><span class="p">(</span><span class="n">joints</span><span class="p">,</span> <span class="n">use_rigid_transforms</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">joints_pos</span> <span class="o">=</span> <span class="n">transforms</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">FC</span><span class="o">.</span><span class="n">N_REV_JOINTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">ee_pos</span> <span class="o">=</span> <span class="n">transforms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">transforms</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">FC</span><span class="o">.</span><span class="n">N_REV_JOINTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">ee_pos</span> <span class="o">-</span> <span class="n">joints_pos</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">T</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">J</span></div>

<div class="viewcode-block" id="FrankaArm.get_collision_boxes_poses"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.get_collision_boxes_poses">[docs]</a>    <span class="k">def</span> <span class="nf">get_collision_boxes_poses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_rigid_transforms</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Computes the transforms of all collision boxes in world frame.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            joints : :obj:`list` </span>
<span class="sd">                Optional: Defaults to None</span>
<span class="sd">                A list of 7 numbers that correspond to to the joint angles in radians</span>
<span class="sd">                If None, will use current real robot joints.</span>
<span class="sd">            use_rigid_transforms : :obj:`bool` </span>
<span class="sd">                Optional: Defaults to False.</span>
<span class="sd">                If True, converts result to RigidTransform objects. This is slower.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            transforms : :obj:`list` </span>
<span class="sd">                A list of RigidTransforms or ndarrays for all collision boxes in world frame.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">joints</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_joints</span><span class="p">()</span>

        <span class="n">fk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_links_transforms</span><span class="p">(</span><span class="n">joints</span><span class="p">,</span> <span class="n">use_rigid_transforms</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">box_poses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">box_n</span><span class="p">,</span> <span class="n">link</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">COLLISION_BOX_LINKS</span><span class="p">):</span>
            <span class="n">link_transform</span> <span class="o">=</span> <span class="n">fk</span><span class="p">[</span><span class="n">link</span><span class="p">]</span>
            <span class="n">box_pose_world</span> <span class="o">=</span> <span class="n">link_transform</span> <span class="o">@</span> <span class="n">FC</span><span class="o">.</span><span class="n">COLLISION_BOX_POSES</span><span class="p">[</span><span class="n">box_n</span><span class="p">]</span>
            <span class="n">box_poses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box_pose_world</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">use_rigid_transforms</span><span class="p">:</span>
            <span class="n">box_transforms</span> <span class="o">=</span> <span class="p">[</span><span class="n">RigidTransform</span><span class="p">(</span>
                        <span class="n">rotation</span><span class="o">=</span><span class="n">box_pose</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span>
                        <span class="n">translation</span><span class="o">=</span><span class="n">box_pose</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> 
                        <span class="n">from_frame</span><span class="o">=</span><span class="s1">&#39;box</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">box_n</span><span class="p">),</span> <span class="n">to_frame</span><span class="o">=</span><span class="s1">&#39;world&#39;</span>
                    <span class="p">)</span> <span class="k">for</span> <span class="n">box_n</span><span class="p">,</span> <span class="n">box_pose</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">box_poses</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">box_transforms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">box_poses</span></div>

<div class="viewcode-block" id="FrankaArm.publish_joints"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.publish_joints">[docs]</a>    <span class="k">def</span> <span class="nf">publish_joints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joints</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Publish the Franka joints to ROS</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            joints : :obj:`list` </span>
<span class="sd">                Optional: Defaults to None</span>
<span class="sd">                A list of 7 numbers that correspond to to the joint angles in radians</span>
<span class="sd">                If None, will use current real robot joints.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">joints</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_joints</span><span class="p">()</span>
                        
        <span class="n">joint_state</span> <span class="o">=</span> <span class="n">JointState</span><span class="p">()</span>
        <span class="n">joint_state</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">FC</span><span class="o">.</span><span class="n">JOINT_NAMES</span>
        <span class="n">joint_state</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">joints</span><span class="p">)</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">joints</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="n">joint_state</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">joints</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_joint_state_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">joint_state</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrankaArm.publish_collision_boxes"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.publish_collision_boxes">[docs]</a>    <span class="k">def</span> <span class="nf">publish_collision_boxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joints</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Publish the Franka collsion boxes to ROS</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            joints : :obj:`list` </span>
<span class="sd">                Optional: Defaults to None</span>
<span class="sd">                A list of 7 numbers that correspond to to the joint angles in radians.</span>
<span class="sd">                If None, will use current real robot joints.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">joints</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_joints</span><span class="p">()</span>

        <span class="n">box_poses_world</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collision_boxes_poses</span><span class="p">(</span><span class="n">joints</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pose</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">box_poses_world</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collision_boxes_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">pose</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">quaternion</span><span class="o">.</span><span class="n">from_rotation_matrix</span><span class="p">(</span><span class="n">pose</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s1">&#39;wxyz&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_collision_boxes_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_collision_boxes_pub</span><span class="o">.</span><span class="n">publish_boxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collision_boxes_data</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrankaArm.check_box_collision"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.check_box_collision">[docs]</a>    <span class="k">def</span> <span class="nf">check_box_collision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">joints</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Checks if the given joint configuration is in collision with a box</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            joints : :obj:`list` </span>
<span class="sd">                Optional: Defaults to None</span>
<span class="sd">                A list of 7 numbers that correspond to to the joint angles in radians</span>
<span class="sd">                If None, will use current real robot joints.</span>

<span class="sd">            box : :obj:`list` </span>
<span class="sd">                The position of the center of the box [x, y, z, r, p, y] and the </span>
<span class="sd">                length, width, and height [l, w, h].</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            in_collision : :obj:`bool`</span>
<span class="sd">                Flag that indicates whether the robot would be in collision. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">box_pos</span><span class="p">,</span> <span class="n">box_rpy</span><span class="p">,</span> <span class="n">box_hsizes</span> <span class="o">=</span> <span class="n">box</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">box_q</span> <span class="o">=</span> <span class="n">quaternion</span><span class="o">.</span><span class="n">from_euler_angles</span><span class="p">(</span><span class="n">box_rpy</span><span class="p">)</span>
        <span class="n">box_axes</span> <span class="o">=</span> <span class="n">quaternion</span><span class="o">.</span><span class="n">as_rotation_matrix</span><span class="p">(</span><span class="n">box_q</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box_vertices_offset</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_offset_signs</span> <span class="o">*</span> <span class="n">box_hsizes</span>
        <span class="n">box_vertices</span> <span class="o">=</span> <span class="p">(</span><span class="n">box_axes</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box_vertices_offset</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">box_pos</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

        <span class="n">box_hdiag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">box_hsizes</span><span class="p">)</span>
        <span class="n">min_col_dists</span> <span class="o">=</span> <span class="n">box_hdiag</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collision_box_hdiags</span>

        <span class="n">franka_box_poses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collision_boxes_poses</span><span class="p">(</span><span class="n">joints</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">franka_box_pose</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">franka_box_poses</span><span class="p">):</span>
            <span class="n">fbox_pos</span> <span class="o">=</span> <span class="n">franka_box_pose</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
            <span class="n">fbox_axes</span> <span class="o">=</span> <span class="n">franka_box_pose</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>

            <span class="c1"># coarse collision check</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">fbox_pos</span> <span class="o">-</span> <span class="n">box_pos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">min_col_dists</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">continue</span>

            <span class="n">fbox_vertex_offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collision_box_vertices_offset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">fbox_vertices</span> <span class="o">=</span> <span class="n">fbox_vertex_offsets</span> <span class="o">@</span> <span class="n">fbox_axes</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">fbox_pos</span>

            <span class="c1"># construct axes</span>
            <span class="n">cross_product_pairs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">box_axes</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">fbox_axes</span><span class="o">.</span><span class="n">T</span><span class="p">)))</span>
            <span class="n">cross_axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">cross_product_pairs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">cross_product_pairs</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collision_proj_axes</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_axes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collision_proj_axes</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">fbox_axes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collision_proj_axes</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">:]</span> <span class="o">=</span> <span class="n">cross_axes</span>

            <span class="c1"># projection</span>
            <span class="n">box_projs</span> <span class="o">=</span> <span class="n">box_vertices</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collision_proj_axes</span>
            <span class="n">fbox_projs</span> <span class="o">=</span> <span class="n">fbox_vertices</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collision_proj_axes</span>
            <span class="n">min_box_projs</span><span class="p">,</span> <span class="n">max_box_projs</span> <span class="o">=</span> <span class="n">box_projs</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">box_projs</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">min_fbox_projs</span><span class="p">,</span> <span class="n">max_fbox_projs</span> <span class="o">=</span> <span class="n">fbox_projs</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">fbox_projs</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># check if no separating planes exist</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">min_box_projs</span> <span class="o">&lt;=</span> <span class="n">max_fbox_projs</span><span class="p">,</span> <span class="n">max_box_projs</span> <span class="o">&gt;=</span> <span class="n">min_fbox_projs</span><span class="p">]):</span>
                <span class="k">return</span> <span class="kc">True</span>
        
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FrankaArm.is_joints_in_collision_with_boxes"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.is_joints_in_collision_with_boxes">[docs]</a>    <span class="k">def</span> <span class="nf">is_joints_in_collision_with_boxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">boxes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Checks if the given joint configuration is in collision with boxes</span>
<span class="sd">        or the workspace walls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            joints : :obj:`list` </span>
<span class="sd">                Optional: Defaults to None</span>
<span class="sd">                A list of 7 numbers that correspond to the joint angles in radians</span>
<span class="sd">                If None, will use current real robot joints.</span>

<span class="sd">            boxes : :obj:`list` </span>
<span class="sd">                List of boxes where each box is a list of 9 floats that contains </span>
<span class="sd">                the position of the center of the box [x, y, z, r, p, y] and the </span>
<span class="sd">                length, width, and height [l, w, h].</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            in_collision : :obj:`bool`</span>
<span class="sd">                Flag that indicates whether the robot would be in collision. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">boxes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">boxes</span> <span class="o">=</span> <span class="n">FC</span><span class="o">.</span><span class="n">WORKSPACE_WALLS</span>

        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">boxes</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box_collision</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">joints</span><span class="o">=</span><span class="n">joints</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Misc</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FrankaArm.reset_joints"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.reset_joints">[docs]</a>    <span class="k">def</span> <span class="nf">reset_joints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Commands Arm to go to hardcoded home joint configuration</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            duration : :obj:`float`</span>
<span class="sd">                How much time this robot motion should take.</span>
<span class="sd">            block : :obj:`bool`</span>
<span class="sd">                Function blocks by default. If False, the function becomes</span>
<span class="sd">                asynchronous and can be preempted.</span>
<span class="sd">            ignore_errors : :obj:`bool`</span>
<span class="sd">                Function ignores errors by default. If False, errors and some </span>
<span class="sd">                exceptions can be thrown.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on control-pc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_joints</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">HOME_JOINTS</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span> <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrankaArm.reset_pose"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.reset_pose">[docs]</a>    <span class="k">def</span> <span class="nf">reset_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Commands Arm to go to hardcoded home pose</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            duration : :obj:`float`</span>
<span class="sd">                How much time this robot motion should take.</span>
<span class="sd">            block : :obj:`bool`</span>
<span class="sd">                Function blocks by default. If False, the function becomes</span>
<span class="sd">                asynchronous and can be preempted.</span>
<span class="sd">            ignore_errors : :obj:`bool`</span>
<span class="sd">                Function ignores errors by default. If False, errors and some </span>
<span class="sd">                exceptions can be thrown.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on control-pc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_pose</span><span class="p">(</span><span class="n">FC</span><span class="o">.</span><span class="n">HOME_POSE</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span> <span class="n">skill_desc</span><span class="o">=</span><span class="n">skill_desc</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="FrankaArm.is_joints_reachable"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.is_joints_reachable">[docs]</a>    <span class="k">def</span> <span class="nf">is_joints_reachable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joints</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the given joint configuration is within joint limits.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            joints : :obj:`list` </span>
<span class="sd">                A list of 7 numbers that correspond to the joint angles in radians.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            joints_reachable : :obj:`bool`</span>
<span class="sd">                Flag that is True if all joints are within joint limits.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">joints</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="n">FC</span><span class="o">.</span><span class="n">JOINT_LIMITS_MIN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="n">FC</span><span class="o">.</span><span class="n">JOINT_LIMITS_MAX</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unimplemented</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FrankaArm.apply_joint_torques"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.apply_joint_torques">[docs]</a>    <span class="k">def</span> <span class="nf">apply_joint_torques</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">torques</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skill_desc</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        NOT IMPLEMENTED YET</span>

<span class="sd">        Commands the arm to apply given joint torques for duration seconds.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            torques : :obj:`list` </span>
<span class="sd">                A list of 7 numbers that correspond to torques in Nm.</span>
<span class="sd">            duration : :obj:`float`</span>
<span class="sd">                How much time this robot motion should take.</span>
<span class="sd">            skill_desc : :obj:`str` </span>
<span class="sd">                Skill description to use for logging on control-pc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="FrankaArm.set_speed"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.set_speed">[docs]</a>    <span class="k">def</span> <span class="nf">set_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        NOT IMPLEMENTED YET</span>

<span class="sd">        Sets the current target speed parameter</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            speed : :obj:`float`</span>
<span class="sd">                Current target speed parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="FrankaArm.get_speed"><a class="viewcode-back" href="../../frankaarm.html#frankapy.FrankaArm.get_speed">[docs]</a>    <span class="k">def</span> <span class="nf">get_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        NOT IMPLEMENTED YET</span>

<span class="sd">        Returns the current target speed parameter</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            speed : :obj:`float`</span>
<span class="sd">                Current target speed parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, Kevin Zhang, Mohit Sharma, Jacky Liang, Oliver Kroemer

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>